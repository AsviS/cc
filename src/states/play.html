<template>

<require from="../planets_pane"></require>
<require from="../planetinfo_pane"></require>
<require from="../audience_pane"></require>
<require from="../gov_pane"></require>
<require from="../econ_pane"></require>
<require from="../diplo_pane"></require>
<require from="../ship_des_pane"></require>
<require from="../fleets_pane"></require>
<require from="../spy_pane"></require>
<require from="../tech_pane"></require>
<require from="../colonize_pane"></require>
<require from="../options_pane"></require>
<!--<require from="../planet_detail"></require>
<require from="../fleet_detail"></require>
<require from="../star_detail"></require>
<require from="../constel_detail"></require>-->

<!-- base layer / nebula background -->
<div id="layout_pagewrap" css="background-image: url(${bg_img});"></div>

<!-- map layer -->
<div id="layout_viewport" class="dragscroll nochilddrag ${app.options.dim_unexplored ? 'option_dim_unexplored' : ''}" css="background-color: rgba(0,0,0,${1.0 - app.options.bg_bright});">
		
	<div id="layout_mapwrap" css="width: ${app.game.galaxy.width}px; height: ${app.game.galaxy.height}px;">
		<div id="layout_map" class="${app.options.show_sectors ? 'sectors' : ''}" css="width: ${app.game.galaxy.width}px; height: ${app.game.galaxy.height}px">
			
<!--			<div style="
				position:absolute; 
				margin-left: 400px; 
				margin-top: 400px; 
				background-color: none;
				background-repeat: no-repeat;
				background-image: url(../x/img/workshop/map/nebula20.png); 
				background-size: 100% 100%;
				width: 2800px;
				height: 2000px;
				">
			</div>
			<div style="
				position:absolute; 
				margin-left:2400px; 
				margin-top: 1200px; 
				background-color: none;
				background-repeat: no-repeat;
				background-image: url(../x/img/workshop/map/objects/crack2.png); 
				background-size: 100% 100%;
				width: 2800px;
				height: 800px;
				">
			</div>
			<div style="
				position:absolute; 
				margin-left: 1800px; 
				margin-top: 1800px; 
				background-color: none;
				background-repeat: no-repeat;
				background-image: url(../x/img/workshop/map/nebula13.png); 
				background-size: 100% 100%;
				width: 1200px;
				height: 1200px;
				">
			</div>-->
			<!-- RANGE LAYER HEADSUP -->
			<div id="range_layer" if.bind="app.options.show_range">
				<!--<div style="color: #FFF; font-size: 10em; font-weight:bold; text-align: center; padding-top: 350px; box-sizing: border-box; background:#2A2; width: 800px; height: 800px; left: 0px; top: 0px; border-radius: 0;">4%</div>
				<div style="color: #FFF; font-size: 10em; font-weight:bold; text-align: center; padding-top: 350px; box-sizing: border-box; background:#2A2; width: 800px; height: 800px; left: 1600px; top: 800px; border-radius: 0; ">82%</div>
				<div style="color: #FFF; font-size: 10em; font-weight:bold; text-align: center; padding-top: 350px; box-sizing: border-box; background:#2A2; width: 800px; height: 800px; left: 0px; top: 800px;  border-radius: 0;">100%</div>
				<div style="color: #FFF; font-size: 10em; font-weight:bold; text-align: center; padding-top: 350px; box-sizing: border-box; background:#2A2; width: 800px; height: 800px; left: 1600px; top: 2400px;  border-radius: 0;"></div>
				<div style="color: #FFF; font-size: 10em; font-weight:bold; text-align: center; padding-top: 350px; box-sizing: border-box; background:#2A2; width: 800px; height: 800px; left: 2400px; top: 800px;  border-radius: 0;">15%</div>
				<div style="color: #FFF; font-size: 10em; font-weight:bold; text-align: center; padding-top: 350px; box-sizing: border-box; background:#2A2; width: 800px; height: 800px; left: 2400px; top: 2400px;  border-radius: 0;">90%</div>
				<div style="color: #FFF; font-size: 10em; font-weight:bold; text-align: center; padding-top: 350px; box-sizing: border-box; background:#2A2; width: 800px; height: 800px; left: 0px; top: 2400px;  border-radius: 0;">45%</div>
				-->
				<template repeat.for="star of app.game.galaxy.stars" containerless>
					<div if.bind="star.settled_by[app.game.myciv.id]" 
						css="
							width: ${app.game.myciv.ship_range*2}px; 
							height: ${app.game.myciv.ship_range*2}px; 
							left:${star.xpos - (app.game.myciv.ship_range)}px; 
							top:${star.ypos - (app.game.myciv.ship_range)}px;
							">		
					</div>
				</template>
			</div>   
			
			<div id="the_caret" class="caret ${caret.class}" if.bind="caret.obj && caret.x && caret.y" css="left:${caret.x}px; top:${caret.y}px;"></div>
			
			<!-- STARS -->
			<div click.trigger="app.ClickStar(star)" repeat.for="star of app.game.galaxy.stars" class="mapobj_container star_${star.color & oneTime} ${star.settled ? 'settled' : ''} ${star.in_range ? 'in_range' : ''} ${star.explored || app.options.see_all ? 'explored' : 'unexplored'}" css="left:${star.xpos & oneTime}px; top:${star.ypos & oneTime}px;">
				<h2 css="${star.ownership_title_css}" >${star.name}</h2>
				<div if.bind="star.planets.length" class="planet_list"><!--  && (star.explored || app.options.see_all) -->
					<a href="#" click.trigger="app.SwitchSideBar(p,$event)" repeat.for="p of star.planets" class="${p.settled ? 'settled' : ''}" css="color: ${p.ui_color};"><svg class="icon icon-nature"><use xlink:href="#icon-nature"></use></svg></a>
				</div>
				<div if.bind="star.fleets.length" class="fleet_list">
					<a href="#" click.trigger="app.SwitchSideBar(f,$event)" repeat.for="f of star.fleets" css="color: ${f.ui_color};">
<!-- 					<svg class="icon icon-transport"><use xlink:href="#icon-transport"></use></svg><span if.bind="app.options.debug">F${f.colonize?'c':''}${f.id}</span> -->
						<svg class="icon icon-transport" if.bind="!f.owner.race.is_monster">
							<use xlink:href="#icon-transport"></use>
						</svg>
						<span class="icon icon-transport" if.bind="f.owner.race.is_monster">✾</span>
					
					</a>
				</div>
			</div>
			
			<!-- ANOMALIES -->
			<template containerless repeat.for="anom of app.game.galaxy.anoms">
				<div if.bind="(anom.onmap && anom.vis_level <= app.game.myciv.vis_level) || app.options.see_all"
					click.trigger="app.ClickStar(anom)" 
					class="mapobj_container anom anom_${anom.type & oneTime} ${anom.settled ? 'settled' : ''} ${anom.in_range ? 'in_range' : ''} ${anom.explored || app.options.see_all ? 'explored' : 'unexplored'}" 
					css="left:${anom.xpos & oneTime}px; top:${anom.ypos & oneTime}px;"
					>
					<h3>${(app.game.turn_num*0 + anom.ResearchIsCompleted(app.game.myciv)) ? anom.name : 'Anomaly' }</h3>
					<p if.bind="app.options.debug">
						${anom.onmap ? 'onmap' : 'deepspace'}<br/>
						${anom.size} / v${anom.vis_level} / o${anom.order} / r${app.game.turn_num*0 + anom.AmountResearched(app.game.myciv)} / ${ anom.collected===null ? '-' : ( anom.collected ? '☒' : '☐' ) }
					</p>
					<div if.bind="anom.fleets.length" class="fleet_list">
						<a href="#" click.trigger="app.SwitchSideBar(f,$event)" repeat.for="f of anom.fleets" css="color: ${f.ui_color};">
							<svg class="icon icon-transport" if.bind="!f.owner.race.is_monster">
								<use xlink:href="#icon-transport"></use>
							</svg>
							<span class="icon icon-transport" if.bind="f.owner.race.is_monster">✾</span>
							<span if.bind="app.options.debug">F${f.colonize?'c':''}${f.id}</span>
						</a>
					</div>
				</div>
			</template>
			
			<div repeat.for="lane of app.game.galaxy.lanes" class="hyperlane" css="left:${lane.x1}px; top:${lane.y1}px; width: ${lane.length}px; transform:  rotate(${lane.angle}deg) translateY(-5px); background-color: rgb( ${lane.color[0]}, ${lane.color[1]}, ${lane.color[2]}); ">
			</div>
		
			<!-- FLEETS EN ROUTE -->
			<template containerless repeat.for="f of app.game.galaxy.fleets" >
				<!-- only display fleets en route -->
				<template containerless if.bind="f.dest && (app.options.show_xtreme_fleets || !app.state_obj.xtreme_zoom) && (app.options.see_all || f.in_range || f.owner == app.game.myciv)">
					<!-- show destination indicator line -->
					<div if.bind="!app.state_obj.xtreme_zoom && app.options.see_all || f.owner == app.game.myciv" class="dest_line" css="left:${f.xpos}px; top:${f.ypos}px; width: ${f.dest_line_length}px; transform:  rotate(${f.dest_line_angle}deg) translateY(-5px); "></div>
					<!-- show fleet icon -->
					<div class="fleet_en_route" css="left:${f.xpos}px; top:${f.ypos}px; border-color: ${f.ui_color};">
						<a href="#" click.delegate="app.SwitchSideBar(f,$event)" css="color: ${f.ui_color};">
							<svg class="icon icon-transport" if.bind="!f.owner.race.is_monster">
								<use xlink:href="#icon-transport"></use>
							</svg>
							<span class="icon icon-transport" if.bind="f.owner.race.is_monster">✾</span>
							<span if.bind="app.options.debug">F${f.colonize?'c':''}${f.id}</span>
						</a>
					</div>
				</template>
			</template>
		</div>		
	</div>
</div>


<!-- UI layer -->
<div id="layout_ui" class="${app.exclusive_ui ? 'exclusive_ui' : ''}">

	<div id="layout_ui_main">
	
		<div id="layout_ui_visor" class="fadeIn" if.bind="!app.main_panel_mode">
			<span class="turn">TURN: ${app.game.turn_num}</span>
			<span class="planets">PLANETS: ${app.game.myciv.planets.length}</span>
			<span class="treasury">TREASURY: $${app.game.myciv.treasury|round:0} ${app.game.myciv.econ.income > 0 ?'+':''}${app.game.myciv.econ.income|round:0}</span>
			<span class="gov">GOV: ${app.game.myciv.gov_pts|round:0} +${app.game.myciv.gov_pts_income|round:0}</span>
			<span class="sci">RESEARCH: <!--${app.game.myciv.research|round}--> +${app.game.myciv.research_income|round:0}</span>
			<span class="sci" if.bind="app.game.myciv.tech.current_project">
				${( app.game.myciv.tech.current_project.rp / app.game.myciv.tech.current_project.node.rp) | percent}% of 	
				${app.game.myciv.tech.current_project.node.name}  
			</span>
			<span>HAB: ${app.game.myciv.race.env.habitation}</span>
			<span>ADAPT: ${app.game.myciv.race.env.adaptation}</span>
	<!-- 		<span class="turn">MODE: ${app.main_panel_mode}</span>			 -->
	<!-- 		<span class="turn">SIDEMODE: ${app.sidebar_mode}</span>			 -->
		</div>
		
		<div id="layout_ui_center">
		
			<div id="layout_ui_news" class="fadeIn" if.bind="!app.main_panel_mode">
				<p><a href="#" class="button micro cool" click.delegate="app.ClearNotes()" if.bind="app.notes.length > 1">Clear Messages</a></p>
				<div repeat.for="note of app.notes" class="${note.type} trekIn" click.trigger="app.ClickNote(note)">
					<a href="#" class="x" click.trigger="app.ClickNote(note,true,false)">🗙</a>
					<h3 if.one-time="note.title">${note.title}</h3>
					<div if.one-time="note.content" innerhtml.bind="note.content"></div>
				</div>
			</div>
			
			<div id="layout_ui_content" class="${app.main_panel_mode ? 'active trekIn' : 'trekOut'}">
				<spy-pane if.bind="app.main_panel_mode == 'spy'"  app.bind="app"  ></spy-pane>
				<planets-pane if.bind="app.main_panel_mode == 'planets'"  ></planets-pane>
				<econ-pane if.bind="app.main_panel_mode == 'econ'"  app.bind="app"  ></econ-pane>
				<gov-pane if.bind="app.main_panel_mode == 'gov'"  app.bind="app"  ></gov-pane>
				<tech-pane if.bind="app.main_panel_mode == 'tech'"  app.bind="app"  ></tech-pane>
				<ship-design-pane if.bind="app.main_panel_mode == 'shipdes'"  app.bind="app"  ></ship-design-pane>
				<fleets-pane if.bind="app.main_panel_mode == 'fleets'"  app.bind="app"  ></fleets-pane>
				<diplo-pane if.bind="app.main_panel_mode == 'diplo'"  app.bind="app"  ></diplo-pane>
				<planetinfo-pane if.bind="app.main_panel_mode == 'planetinfo'" planet.bind="app.main_panel_obj" app.bind="app"  ></planetinfo-pane>
				<audience-pane if.bind="app.main_panel_mode == 'audience'" data.bind="app.main_panel_data" civ.bind="app.main_panel_obj" app.bind="app"  ></audience-pane>
				<colonize-pane if.bind="app.main_panel_mode == 'colonize'" planet.bind="app.main_panel_obj" app.bind="app"  ></colonize-pane>
				<options-pane if.bind="app.main_panel_mode == 'options'" app.bind="app"  ></options-pane>
			</div>

		</div>

		<div id="layout_ui_footer" class="fadeIn" if.bind="!app.main_panel_mode">
			<a href="#" click.delegate="app.MapZoomIn()" class="button cool bold">+</a>
			<a href="#" click.delegate="app.MapZoomOut()" class="button cool bold">-</a>
			<a href="#" click.delegate="app.MapScroll(0,-400)" class="button cool">▲</a>
			<a href="#" click.delegate="app.MapScroll(0,400)" class="button cool">▼</a>
			<a href="#" click.delegate="app.MapScroll(-400,0)" class="button cool">◀</a>
			<a href="#" click.delegate="app.MapScroll(400,0)" class="button cool">▶</a>
			<a href="#" click.delegate="app.ToggleOption('show_range')" class="button ${app.options.show_range ? 'alt' : 'cool'}">◯</a>
			<a href="#" click.delegate="app.ToggleOption('show_sectors')" class="button ${app.options.show_sectors ? 'alt' : 'cool'}">⛶</a>
			<a href="#" click.delegate="app.ToggleOption('see_all')" class="button ${app.options.see_all ? 'alt' : 'cool'}">★</a>
			<a href="#" click.delegate="app.ToggleOption('show_xtreme_fleets')" class="button ${app.options.show_xtreme_fleets ? 'alt' : 'cool'}">▪</a>
			<a href="#" click.delegate="app.ToggleOption('debug')" class="button ${app.options.debug ? 'alt' : 'cool'}">❇</a>
			<a href="#" click.delegate="app.ToggleOption('ai')" class="button ${app.options.ai ? 'alt' : 'cool'}">AI</a>
			<a href="#" click.delegate="app.state_obj.DramaticIntro()" class="button">✈</a>
			<a href="#" click.delegate="app.game.DoEvent()" class="button">EVENT</a>
<!-- 			<span if.bind="app.game.myciv.econ.mp_need_met < 1.0" class="bad">Not Enough Resources!</span> -->
		</div>
		
	</div>

	<div id="layout_ui_side" class="trekIn" if.bind="app.sidebar_mode && app.sidebar_obj">		
		<compose if.bind="app.sidebar_mode && app.sidebar_obj" model.bind="{app: app, obj: app.sidebar_obj}"  view-model="../ui/sidebars/sidebar_${app.sidebar_mode}" containerless></compose>
	</div>
	
	<div id="layout_ui_nav" class="slideInRight">
		<a href="#" id="nav_button_map" click.delegate="app.ReturnToMap()"><svg class="icon icon-night"><use xlink:href="#icon-night"></use></svg></a>
		<a href="#" id="nav_button_galaxy" click.delegate="app.ChangeState('setup_new')" ><svg class="icon icon-black-1"><use xlink:href="#icon-black-1"></use></svg></a>
		<a href="#" id="nav_button_planets" click.delegate="app.SwitchMainPanel('planets')"><svg class="icon icon-nature-1"><use xlink:href="#icon-nature-1"></use></svg></a>
		<a href="#" id="nav_button_econ" click.delegate="app.SwitchMainPanel('econ')"><svg class="icon icon-coins-2"><use xlink:href="#icon-coins-2"></use></svg></a>
		<a href="#" id="nav_button_gov" click.delegate="app.SwitchMainPanel('gov')"><svg class="icon icon-building"><use xlink:href="#icon-building"></use></svg></a>
		<a href="#" id="nav_button_spy" click.delegate="app.SwitchMainPanel('spy')"><svg class="icon icon-medical"><use xlink:href="#icon-medical"></use></svg></a>
		<a href="#" id="nav_button_tech" click.delegate="app.SwitchMainPanel('tech')"><svg class="icon icon-tool"><use xlink:href="#icon-tool"></use></svg></a>
		<a href="#" id="nav_button_diplo" click.delegate="app.SwitchMainPanel('diplo')"><svg class="icon icon-shapes-2"><use xlink:href="#icon-shapes-2"></use></svg></a>
		<a href="#" id="nav_button_fleets" click.delegate="app.SwitchMainPanel('fleets')"><svg class="icon icon-transport"><use xlink:href="#icon-transport"></use></svg></a>
		<a href="#" id="nav_button_victory" click.delegate="app.ToggleOption('dim_unexplored')" ><svg class="icon icon-black"><use xlink:href="#icon-black"></use></svg></a>
		<a href="#" id="nav_button_opt" click.delegate="app.SwitchMainPanel('options')" ><svg class="icon icon-gear"><use xlink:href="#icon-gear"></use></svg></a>
		<a href="#" id="nav_button_help" click.delegate="app.FocusMap(app.game.galaxy.civs[0].planets[0])" ><svg class="icon icon-signs"><use xlink:href="#icon-signs"></use></svg></a>
		<a href="#" id="nav_button_turn" click.delegate="app.game.ToggleAutoPlay()" css="color: ${app.game.autoplay ? '#AFA' : '#FFF' }"><svg class="icon icon-arrows"><use xlink:href="#icon-arrows"></use></svg></a>
		<a href="#" id="nav_button_turn" click.delegate="app.game.ProcessTurn()"css="color: ${app.game.processing_turn ? '#AFA' : '#FFF' }" ><svg class="icon icon-arrows"><use xlink:href="#icon-arrows"></use></svg></a>
	</div>

</div>


<!-- modal layer -->
<div id="layout_modal" class="${(app.modal_header || app.modal_content || app.game.eventcard ) ? 'trekIn' : 'trekOut'}">
	
	<!-- messages -->
	<div class="dialog" if.bind="app.modal_header">
		<h2>${app.modal_header}</h2>
		<div innerhtml.bind="app.modal_content"></div>
		<p><a href="#" click.delegate="app.CloseDialog()" class="button">OK</a>
	</div>
	
	<!-- events -->
	<div class="dialog event" if.bind="app.game.eventcard">
		<h2 if.bind="app.game.eventcard.title" >${app.game.eventcard.title}</h2>
		<div class="event_text" innerhtml.bind="app.game.eventcard.text"></div>
		
		<div class="event_option" repeat.for="o of app.game.eventcard.options" click.delegate="app.game.ChooseEventCardOption(o)" >
			<p if.bind="o.title" >${o.title}</p>
			<div innerhtml.bind="o.text"></div>
		</div>
		
		<p if.bind="!app.game.eventcard.options">
			<a href="#" click.delegate="app.game.ChooseEventCardOption()" class="button">OK</a>
		</p>
	</div>
	
</div>


</template>
