<template>

<!-- base layer / nebula background -->
<div id="layout_pagewrap" css="background-image: url(${bg_img});"></div>

<!-- map layer -->
<div id="layout_viewport" class="dragscroll nochilddrag ${app.options.show_xtreme_anoms ? '' : 'hide_xtreme_anoms'} ${app.options.dim_unexplored ? 'option_dim_unexplored' : ''}" css="background-color: rgba(0,0,0,${1.0 - app.options.bg_bright});">
		
	<div id="layout_mapwrap" css="width: ${app.game.galaxy.width}px; height: ${app.game.galaxy.height}px;">
		<div id="layout_map" class="${app.options.show_sectors ? 'sectors' : ''}" css="width: ${app.game.galaxy.width}px; height: ${app.game.galaxy.height}px">
			<!-- RANGE LAYER HEADSUP -->
			<div id="range_layer" if.bind="app.options.show_range">
				<template repeat.for="star of app.game.galaxy.stars" containerless>
					<div if.bind="star.settled_by[app.game.myciv.id]" 
						css="
							width: ${app.game.myciv.ship_range*2}px; 
							height: ${app.game.myciv.ship_range*2}px; 
							left:${star.xpos - (app.game.myciv.ship_range)}px; 
							top:${star.ypos - (app.game.myciv.ship_range)}px;
							">		
					</div>
				</template>
				<!-- DEBUG / AI system value -->
<!--				<template repeat.for="star of app.game.galaxy.stars" containerless>
					<div 
						css="
							width: ${star.player_score*10}px; 
							height: ${star.player_score*10}px; 
							left:${star.xpos - (star.player_score*5)}px; 
							top:${star.ypos - (star.player_score*5)}px;
							">		
					</div>
				</template>-->
			</div>   
			
			<div id="the_caret" class="caret ${caret.class}" if.bind="caret.obj && caret.x && caret.y" css="left:${caret.x}px; top:${caret.y}px;"></div>
			
			<!-- STARS -->
			<div click.delegate="app.ClickStar(star,$event)" 
				contextmenu.delegate="app.ClickStar(star,$event)" 
				repeat.for="star of app.game.galaxy.stars" 
				class="mapobj_container star_${star.color & oneTime} 
				${star.settled ? 'settled' : ''} 
				${star.in_range ? 'in_range' : 'out_range'} 
				${star.explored || app.options.see_all ? 'explored' : 'unexplored'}" 
				css="left:${star.xpos & oneTime}px; top:${star.ypos & oneTime}px;">
				<h2 css="${star.ownership_title_css}" >${star.name}</h2>
				<div if.bind="star.planets.length" class="planet_list"><!--  && (star.explored || app.options.see_all) -->
					<a href="#" click.trigger="app.SwitchSideBar(p,$event)" repeat.for="p of star.planets" class="${p.settled ? 'settled' : ''}" css="color: ${p.ui_color};"><svg class="icon icon-nature"><use xlink:href="#icon-nature"></use></svg></a>
				</div>
				<div if.bind="star.fleets.length" class="fleet_list">
					<a href="#" click.trigger="app.SwitchSideBar(f,$event)" repeat.for="f of star.fleets" css="color: ${f.ui_color};">
<!-- 					<svg class="icon icon-transport"><use xlink:href="#icon-transport"></use></svg><span if.bind="app.options.debug">F${f.colonize?'c':''}${f.id}</span> -->
						<svg class="icon icon-transport" if.bind="!f.owner.race.is_monster">
							<use xlink:href="#icon-transport"></use>
						</svg>
						<span class="icon icon-transport" if.bind="f.owner.race.is_monster">‚úæ</span>
					
					</a>
				</div>
			</div>
			
			<!-- ANOMALIES -->
			<template containerless repeat.for="anom of app.game.galaxy.anoms">
				<div if.bind="(anom.onmap && anom.vis_level <= app.game.myciv.vis_level) || app.options.see_all"
					click.delegate="app.ClickStar(anom,$event)"  
					contextmenu.delegate="app.ClickStar(anom,$event)" 
					class="mapobj_container anom anom_${anom.type & oneTime} ${anom.settled ? 'settled' : ''} ${anom.in_range ? 'in_range' : 'out_range'} ${anom.explored || app.options.see_all ? 'explored' : 'unexplored'}" 
					css="left:${anom.xpos & oneTime}px; top:${anom.ypos & oneTime}px;"
					>
					<h3>${(app.game.turn_num*0 + anom.ResearchIsCompleted(app.game.myciv)) ? anom.name : 'Anomaly' }</h3>
					<p if.bind="app.options.debug">
						${anom.onmap ? 'onmap' : 'deepspace'}<br/>
						${anom.size} / v${anom.vis_level} / o${anom.order} / r${app.game.turn_num*0 + anom.AmountResearched(app.game.myciv)} / ${ anom.collected===null ? '-' : ( anom.collected ? '‚òí' : '‚òê' ) }
					</p>
					<div if.bind="anom.fleets.length" class="fleet_list">
						<a href="#" click.trigger="app.SwitchSideBar(f,$event)" repeat.for="f of anom.fleets" css="color: ${f.ui_color};">
							<svg class="icon icon-transport" if.bind="!f.owner.race.is_monster">
								<use xlink:href="#icon-transport"></use>
							</svg>
							<span class="icon icon-transport" if.bind="f.owner.race.is_monster">‚úæ</span>
							<span if.bind="app.options.debug">F${f.colonize?'c':''}${f.id}</span>
						</a>
					</div>
				</div>
			</template>
			
			<div repeat.for="lane of app.game.galaxy.lanes" class="hyperlane" css="left:${lane.x1}px; top:${lane.y1}px; width: ${lane.length}px; transform:  rotate(${lane.angle}deg) translateY(-5px); background-color: rgb( ${lane.color[0]}, ${lane.color[1]}, ${lane.color[2]}); ">
			</div>
		
			<!-- FLEETS EN ROUTE -->
			<template containerless repeat.for="f of app.game.galaxy.fleets" >
				<!-- only display fleets en route -->
				<template containerless if.bind="f.dest && (app.options.show_xtreme_fleets || !app.state_obj.xtreme_zoom) && (app.options.see_all || f.in_range || f.owner == app.game.myciv)">
					<!-- show destination indicator line -->
					<div if.bind="!app.state_obj.xtreme_zoom && app.options.see_all || f.owner == app.game.myciv" class="dest_line" css="left:${f.xpos}px; top:${f.ypos}px; width: ${f.dest_line_length}px; transform:  rotate(${f.dest_line_angle}deg) translateY(-5px); "></div>
					<!-- show fleet icon -->
					<div class="fleet_en_route" css="left:${f.xpos}px; top:${f.ypos}px; border-color: ${f.ui_color};">
						<a href="#" click.delegate="app.SwitchSideBar(f,$event)" css="color: ${f.ui_color};">
							<svg class="icon icon-transport" if.bind="!f.owner.race.is_monster">
								<use xlink:href="#icon-transport"></use>
							</svg>
							<span class="icon icon-transport" if.bind="f.owner.race.is_monster">‚úæ</span>
							<span if.bind="app.options.debug">F${f.colonize?'c':''}${f.id}</span>
						</a>
					</div>
				</template>
			</template>
		</div>		
	</div>
</div>


<!-- UI layer -->
<div id="layout_ui" class="${app.exclusive_ui ? 'exclusive_ui' : ''}">

	<div id="layout_ui_main">
	
		<div id="layout_ui_visor" class="fadeIn" if.bind="!app.main_panel_mode">
			<span class="turn">TURN: ${app.game.turn_num}</span>
			<span class="planets">PLANETS: ${app.game.myciv.planets.length}</span>
			<span class="treasury">TREASURY: $${app.game.myciv.treasury|round:0} ${app.game.myciv.econ.income > 0 ?'+':''}${app.game.myciv.econ.income|round:0}</span>
			<span class="sci">RESEARCH: <!--${app.game.myciv.research|round}--> +${app.game.myciv.research_income|round:0}</span>
			<span class="sci" if.bind="app.game.myciv.tech.current_project" click.delegate="app.SwitchMainPanel('tech')">
				${( app.game.myciv.tech.current_project.rp / app.game.myciv.tech.current_project.node.rp) | percent}% of 	
				${app.game.myciv.tech.current_project.node.name}  
			</span>
			<span>HAB: ${app.game.myciv.race.env.habitation}</span>
			<span>ADAPT: ${app.game.myciv.race.env.adaptation}</span>
		</div>
		
		<div id="layout_ui_center">
		
			<div id="layout_ui_news" class="fadeIn" if.bind="!app.main_panel_mode">
				<p><a href="#" class="button micro cool" click.delegate="app.ClearNotes()" if.bind="app.notes.length > 1">Clear Messages</a></p>
				<div repeat.for="note of app.notes" class="${note.type} trekIn" click.trigger="app.ClickNote(note)">
					<a href="#" class="x" click.trigger="app.ClickNote(note,true,false)">üóô</a>
					<h3 if.one-time="note.title">${note.title}</h3>
					<div if.one-time="note.content" innerhtml.bind="note.content"></div>
				</div>
			</div>
			
			<div id="layout_ui_content" class="${app.main_panel_mode ? 'active trekIn' : 'trekOut'}">
				<compose if.bind="app.main_panel_mode" 
					model.bind="{app: app, obj: app.main_panel_obj, data: app.main_panel_data}"  
					view-model="../ui/panes/${app.main_panel_mode}_pane" containerless>
				</compose>
			</div>

		</div>

		<div id="layout_ui_footer" class="fadeIn" if.bind="!app.main_panel_mode">
			<a href="#" click.delegate="app.MapZoomIn()" class="button cool bold">+</a>
			<a href="#" click.delegate="app.MapZoomOut()" class="button cool bold">-</a>
			<a href="#" click.delegate="app.MapScroll(0,-400)" class="button cool">‚ñ≤</a>
			<a href="#" click.delegate="app.MapScroll(0,400)" class="button cool">‚ñº</a>
			<a href="#" click.delegate="app.MapScroll(-400,0)" class="button cool">‚óÄ</a>
			<a href="#" click.delegate="app.MapScroll(400,0)" class="button cool">‚ñ∂</a>
			<a href="#" click.delegate="app.ToggleOption('show_range')" class="button ${app.options.show_range ? 'alt' : 'cool'}">‚óØ</a>
			<a href="#" click.delegate="app.ToggleOption('show_sectors')" class="button ${app.options.show_sectors ? 'alt' : 'cool'}">‚õ∂</a>
			<a href="#" click.delegate="app.ToggleOption('see_all')" class="button ${app.options.see_all ? 'alt' : 'cool'}">‚òÖ</a>
			<a href="#" click.delegate="app.ToggleOption('show_xtreme_fleets')" class="button ${app.options.show_xtreme_fleets ? 'alt' : 'cool'}">‚ñ™</a>
			<a href="#" click.delegate="app.ToggleOption('debug')" class="button ${app.options.debug ? 'alt' : 'cool'}">‚ùá</a>
			<a href="#" click.delegate="app.ToggleOption('show_xtreme_anoms')" class="button ${app.options.show_xtreme_anoms ? 'alt' : 'cool'}">‚ñ∞</a>
			<a href="#" click.delegate="app.ToggleOption('ai')" class="button ${app.options.ai ? 'alt' : 'cool'}">AI</a>
			<a href="#" click.delegate="app.ToggleOption('ship_scaling')" class="button ${app.options.ship_scaling ? 'alt' : 'cool'}">DS</a>
			<a href="#" click.delegate="app.state_obj.DramaticIntro()" class="button">‚úà</a>
			<a href="#" click.delegate="app.game.DoEvent()" class="button">EVENT</a>
<!-- 			<span if.bind="app.game.myciv.econ.mp_need_met < 1.0" class="bad">Not Enough Resources!</span> -->
		</div>
		
	</div>

	<div id="layout_ui_side" class="trekIn" if.bind="app.sidebar_mode && app.sidebar_obj">		
		<compose if.bind="app.sidebar_mode && app.sidebar_obj" model.bind="{app: app, obj: app.sidebar_obj}"  view-model="../ui/sidebars/sidebar_${app.sidebar_mode}" containerless></compose>
	</div>
	
	<div id="layout_ui_nav" class="slideInRight">
		<a href="#" id="nav_button_map" click.delegate="app.ReturnToMap()"><svg class="icon icon-night"><use xlink:href="#icon-night"></use></svg></a>
		<a href="#" id="nav_button_galaxy" click.delegate="app.ChangeState('setup_new')" ><svg class="icon icon-black-1"><use xlink:href="#icon-black-1"></use></svg></a>
		<a href="#" id="nav_button_planets" click.delegate="app.SwitchMainPanel('planets')"><svg class="icon icon-nature-1"><use xlink:href="#icon-nature-1"></use></svg></a>
		<a href="#" id="nav_button_econ" click.delegate="app.SwitchMainPanel('econ')"><svg class="icon icon-coins-2"><use xlink:href="#icon-coins-2"></use></svg></a>
		<a href="#" id="nav_button_gov" click.delegate="app.SwitchMainPanel('gov')"><svg class="icon icon-building"><use xlink:href="#icon-building"></use></svg></a>
		<a href="#" id="nav_button_spy" click.delegate="app.SwitchMainPanel('spy')"><svg class="icon icon-medical"><use xlink:href="#icon-medical"></use></svg></a>
		<a href="#" id="nav_button_tech" click.delegate="app.SwitchMainPanel('tech')"><svg class="icon icon-tool"><use xlink:href="#icon-tool"></use></svg></a>
		<a href="#" id="nav_button_diplo" click.delegate="app.SwitchMainPanel('diplo')"><svg class="icon icon-shapes-2"><use xlink:href="#icon-shapes-2"></use></svg></a>
		<a href="#" id="nav_button_ship_des" click.delegate="app.SwitchMainPanel('shipdes')"><svg class="icon icon-transport"><use xlink:href="#icon-transport"></use></svg></a>
		<a href="#" id="nav_button_fleets" click.delegate="app.SwitchMainPanel('fleets')"><svg class="icon icon-transport"><use xlink:href="#icon-transport"></use></svg></a>
		<a href="#" id="nav_button_victory" click.delegate="app.ToggleOption('dim_unexplored')" ><svg class="icon icon-black"><use xlink:href="#icon-black"></use></svg></a>
		<a href="#" id="nav_button_opt" click.delegate="app.SwitchMainPanel('options')" ><svg class="icon icon-gear"><use xlink:href="#icon-gear"></use></svg></a>
		<a href="#" id="nav_button_help" click.delegate="app.FocusMap(app.game.galaxy.civs[0].planets[0])" ><svg class="icon icon-signs"><use xlink:href="#icon-signs"></use></svg></a>
		<a href="#" id="nav_button_turn" click.delegate="app.game.ToggleAutoPlay()" css="color: ${app.game.autoplay ? '#AFA' : '#FFF' }"><svg class="icon icon-arrows"><use xlink:href="#icon-arrows"></use></svg></a>
		<a href="#" id="nav_button_turn" click.delegate="app.game.ProcessTurn()"css="color: ${app.game.processing_turn ? '#AFA' : '#FFF' }" ><svg class="icon icon-arrows"><use xlink:href="#icon-arrows"></use></svg></a>
	</div>

</div>


<!-- modal layer -->
<div id="layout_modal" class="${(app.modal || app.game.eventcard ) ? 'trekIn' : 'trekOut'}">
	
	<!-- messages -->
	<div class="dialog" if.bind="app.modal">
		<h2>${app.modal.header}</h2>
		<div innerhtml.bind="app.modal.content"></div>
		<p class="button_rack ${app.modal.buttons.length > 1 ? 'button_rack_fill' : ''}" >
			<button click.delegate="app.ClickDialogButton(btn)" repeat.for="btn of app.modal.buttons" class="${btn.class}">${btn.text}</button>
    	</p>
	</div>
	
	<!-- events -->
	<div class="dialog event" if.bind="app.game.eventcard">
		<h2 if.bind="app.game.eventcard.title" >${app.game.eventcard.title}</h2>
		<div class="event_text" innerhtml.bind="app.game.eventcard.text"></div>
		
		<div class="event_option" repeat.for="o of app.game.eventcard.options" click.delegate="app.game.ChooseEventCardOption(o)" >
			<p if.bind="o.title" >${o.title}</p>
			<div innerhtml.bind="o.text"></div>
		</div>
		
		<p if.bind="!app.game.eventcard.options">
			<a href="#" click.delegate="app.game.ChooseEventCardOption()" class="button">OK</a>
		</p>
	</div>
	
</div>


</template>
