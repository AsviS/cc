<template>

<require from="../planets_pane"></require>
<require from="../planetinfo_pane"></require>
<require from="../audience_pane"></require>
<require from="../gov_pane"></require>
<require from="../econ_pane"></require>
<require from="../diplo_pane"></require>
<require from="../ship_des_pane"></require>
<require from="../fleets_pane"></require>
<require from="../spy_pane"></require>
<require from="../tech_pane"></require>
<require from="../colonize_pane"></require>
<require from="../options_pane"></require>
<!--<require from="../planet_detail"></require>
<require from="../fleet_detail"></require>
<require from="../star_detail"></require>
<require from="../constel_detail"></require>-->

<!-- base layer -->
<div id="layout_pagewrap"></div>

<!-- map layer -->
<div id="layout_viewport" class="dragscroll nochilddrag ${app.options.dim_unexplored ? 'option_dim_unexplored' : ''}">
		
	<div id="layout_mapwrap" css="width: ${app.game.galaxy.width}px; height: ${app.game.galaxy.height}px;">
		<div id="layout_map" class="${app.options.show_sectors ? 'sectors' : ''}" css="width: ${app.game.galaxy.width}px; height: ${app.game.galaxy.height}px">
			
			<div id="range_layer" if.bind="app.options.show_range">
				<template repeat.for="star of app.game.galaxy.stars" containerless>
					<div if.bind="star.settled_by[app.game.myciv.id]" 
						css="
							width: ${app.game.myciv.ship_range}px; 
							height: ${app.game.myciv.ship_range}px; 
							left:${star.xpos - (app.game.myciv.ship_range/2)}px; 
							top:${star.ypos - (app.game.myciv.ship_range/2)}px;
							background-color: rgb( 
								${app.game.myciv.color_rgb[0]}, 
								${app.game.myciv.color_rgb[1]}, 
								${app.game.myciv.color_rgb[2]} );
							">		
					</div>
				</template>
			</div>
<!--			<div style="
				position:absolute; 
				margin-left: 400px; 
				margin-top: 400px; 
				background-color: none;
				background-repeat: no-repeat;
				background-image: url(../x/img/workshop/map/nebula20.png); 
				background-size: 100% 100%;
				width: 1600px;
				height: 1000px;
				">
			</div>-->
<!--			<div style="
				position:absolute; 
				margin-left: 1800px; 
				margin-top: 1800px; 
				background-color: none;
				background-repeat: no-repeat;
				background-image: url(../x/img/workshop/map/nebula13.png); 
				background-size: 100% 100%;
				width: 1200px;
				height: 1200px;
				">
			</div>-->
			<div click.trigger="app.ClickStar(star)" repeat.for="star of app.game.galaxy.stars" class="planet_container star_${star.color} ${star.settled ? 'settled' : ''} ${star.in_range ? 'in_range' : ''} ${star.explored || app.options.see_all ? 'explored' : 'unexplored'}" css="left:${star.xdivpos}px; top:${star.ydivpos}px;">
				<div id="the_caret" class="caret" if.bind="app.hilite_star == star"></div>
				<h2 css="${star.ownership_title_css}" >${star.name}</h2>
				<div if.bind="star.planets.length && (star.explored || app.options.see_all)" class="planet_list">	
					<a href="#" click.trigger="app.SwitchSideBar(p,$event)" repeat.for="p of star.planets" class="${star.settled ? 'settled' : ''}" css="color: ${p.ui_color};"><svg class="icon icon-nature"><use xlink:href="#icon-nature"></use></svg></a>
				</div>
				<div if.bind="star.fleets.length" class="fleet_list">
					<a href="#" click.trigger="app.SwitchSideBar(f,$event)" repeat.for="f of star.fleets" css="color: ${f.ui_color};">F${f.colonize?'c':''}${f.id}<svg class="icon icon-transport"><use xlink:href="#icon-transport"></use></svg></a>
				</div>
			</div>
			
			<div repeat.for="lane of app.game.galaxy.lanes" class="hyperlane" css="left:${lane.x1}px; top:${lane.y1}px; width: ${lane.length}px; transform:  rotate(${lane.angle}deg) translateY(-5px); background-color: rgb( ${lane.color[0]}, ${lane.color[1]}, ${lane.color[2]}); ">
			</div>
		
			<template containerless repeat.for="f of app.game.galaxy.fleets" >
					<!-- only display fleets en route -->
				<template containerless if.bind="f.dest">
					<!-- show destination indicator line -->
					<div class="dest_line" css="left:${f.xpos}px; top:${f.ypos}px; width: ${f.dest_line_length}px; transform:  rotate(${f.dest_line_angle}deg) translateY(-5px); "></div>
					<!-- show fleet icon -->
					<div class="fleet_en_route" css="left:${f.xpos}px; top:${f.ypos}px;">
						<a href="#" click.delegate="app.SwitchSideBar(f,$event)" css="color: ${f.ui_color};">F${f.colonize?'c':''}${f.id}<svg class="icon icon-transport"><use xlink:href="#icon-transport"></use></svg></a>
					</div>
				</template>
			</template>
		</div>		
	</div>
</div>


<!-- UI layer -->
<div id="layout_ui">

	<div id="layout_ui_main">
	
		<div id="layout_ui_visor" class="fadeIn" if.bind="!app.main_panel_mode">
			<span class="turn">TURN: ${app.game.turn_num}</span>
			<span class="planets">PLANETS: ${app.game.myciv.planets.length}</span>
			<span class="treasury">TREASURY: $${app.game.myciv.treasury|round:0} ${app.game.myciv.econ.income > 0 ?'+':''}${app.game.myciv.econ.income|round:0}</span>
			<span class="gov">GOV: ${app.game.myciv.gov_pts|round:0} +${app.game.myciv.gov_pts_income|round:0}</span>
			<span class="sci">RESEARCH: ${app.game.myciv.research|round} +${app.game.myciv.research_income|round:0}</span>
	<!-- 		<span class="turn">MODE: ${app.main_panel_mode}</span>			 -->
	<!-- 		<span class="turn">SIDEMODE: ${app.sidebar_mode}</span>			 -->
		</div>
		
		<div id="layout_ui_center">
		
			<div id="layout_ui_news" class="fadeIn" if.bind="!app.main_panel_mode">
				<div repeat.for="note of app.notes" class="${note.type} trekIn" click.trigger="app.ClickNote(note)">
					<h3 if.one-time="note.title">${note.title}</h3>
					<div if.one-time="note.content" innerhtml.bind="note.content"></div>
				</div>
			</div>
			
			<div id="layout_ui_content" class="${app.main_panel_mode ? 'active trekIn' : 'trekOut'}">
				<spy-pane if.bind="app.main_panel_mode == 'spy'"  app.bind="app"  ></spy-pane>
				<planets-pane if.bind="app.main_panel_mode == 'planets'"  ></planets-pane>
				<econ-pane if.bind="app.main_panel_mode == 'econ'"  app.bind="app"  ></econ-pane>
				<gov-pane if.bind="app.main_panel_mode == 'gov'"  app.bind="app"  ></gov-pane>
				<tech-pane if.bind="app.main_panel_mode == 'tech'"  app.bind="app"  ></tech-pane>
				<ship-design-pane if.bind="app.main_panel_mode == 'shipdes'"  app.bind="app"  ></ship-design-pane>
				<fleets-pane if.bind="app.main_panel_mode == 'fleets'"  app.bind="app"  ></fleets-pane>
				<diplo-pane if.bind="app.main_panel_mode == 'diplo'"  app.bind="app"  ></diplo-pane>
				<planetinfo-pane if.bind="app.main_panel_mode == 'planetinfo'" planet.bind="app.main_panel_obj" app.bind="app"  ></planetinfo-pane>
				<audience-pane if.bind="app.main_panel_mode == 'audience'" civ.bind="app.main_panel_obj" app.bind="app"  ></audience-pane>
				<colonize-pane if.bind="app.main_panel_mode == 'colonize'" planet.bind="app.main_panel_obj" app.bind="app"  ></colonize-pane>
				<options-pane if.bind="app.main_panel_mode == 'options'" app.bind="app"  ></options-pane>
			</div>

		</div>

		<div id="layout_ui_footer" class="fadeIn" if.bind="!app.main_panel_mode">
			<a href="#" click.delegate="app.MapZoomIn()">[+]</a>
			<a href="#" click.delegate="app.MapZoomOut()">[-]</a>
			<span if.bind="app.game.myciv.econ.mp_need_met < 1.0" class="bad">Not Enough Resources!</span>
		</div>
		
	</div>

	<div id="layout_ui_side" class="trekIn" if.bind="app.sidebar_mode && app.sidebar_obj">		
		<compose if.bind="app.sidebar_mode && app.sidebar_obj" view-model="../ui/sidebars/sidebar_${app.sidebar_mode}" model.bind="{app: app, obj: app.sidebar_obj}" containerless></compose>
	</div>
	
	<div id="layout_ui_nav" class="slideInRight">
		<a href="#" id="nav_button_map" click.delegate="app.ReturnToMap()"><svg class="icon icon-night"><use xlink:href="#icon-night"></use></svg></a>
		<a href="#" id="nav_button_galaxy" click.delegate="app.game.RegenerateGalaxy()" ><svg class="icon icon-black-1"><use xlink:href="#icon-black-1"></use></svg></a>
		<a href="#" id="nav_button_planets" click.delegate="app.SwitchMainPanel('planets')"><svg class="icon icon-nature-1"><use xlink:href="#icon-nature-1"></use></svg></a>
		<a href="#" id="nav_button_econ" click.delegate="app.SwitchMainPanel('econ')"><svg class="icon icon-coins-2"><use xlink:href="#icon-coins-2"></use></svg></a>
		<a href="#" id="nav_button_gov" click.delegate="app.SwitchMainPanel('gov')"><svg class="icon icon-building"><use xlink:href="#icon-building"></use></svg></a>
		<a href="#" id="nav_button_spy" click.delegate="app.SwitchMainPanel('spy')"><svg class="icon icon-medical"><use xlink:href="#icon-medical"></use></svg></a>
		<a href="#" id="nav_button_tech" click.delegate="app.SwitchMainPanel('tech')"><svg class="icon icon-tool"><use xlink:href="#icon-tool"></use></svg></a>
		<a href="#" id="nav_button_diplo" click.delegate="app.SwitchMainPanel('diplo')"><svg class="icon icon-shapes-2"><use xlink:href="#icon-shapes-2"></use></svg></a>
		<a href="#" id="nav_button_fleets" click.delegate="app.SwitchMainPanel('fleets')"><svg class="icon icon-transport"><use xlink:href="#icon-transport"></use></svg></a>
<!-- 		<a href="#" id="nav_button_shipdes" click.delegate="app.ToggleOption('show_sectors')"><svg class="icon icon-transport"><use xlink:href="#icon-transport"></use></svg></a> -->
		<a href="#" id="nav_button_victory" click.delegate="app.ToggleOption('dim_unexplored')" ><svg class="icon icon-black"><use xlink:href="#icon-black"></use></svg></a>
		<a href="#" id="nav_button_opt" click.delegate="app.SwitchMainPanel('options')" ><svg class="icon icon-gear"><use xlink:href="#icon-gear"></use></svg></a>
		<a href="#" id="nav_button_help" click.delegate="app.ChangeState('setup_new')" ><svg class="icon icon-signs"><use xlink:href="#icon-signs"></use></svg></a>
		<a href="#" id="nav_button_turn" click.delegate="app.game.ProcessTurn()" ><svg class="icon icon-arrows"><use xlink:href="#icon-arrows"></use></svg></a>
<!-- 		<a href="#" click.delegate="ShowDialog( 'Liked Pie', 'it was all true. all until it pied.' )">dia</a> -->
	</div>

</div>


<!-- modal layer -->
<!-- if.bind="modal_header || modal_content" -->
<div id="layout_modal"  class="${(app.modal_header || app.modal_content) ? 'trekIn' : 'trekOut'}">
	<div class="dialog modal" >
		<h2>${app.modal_header}</h2>
		<p>${app.modal_content}</p>
		<p><a href="#" click.delegate="app.CloseDialog()">OK</a>
	</div>
</div>







<script>


	
// dramatic intro
// $( document ).ready(function() {
// 	
// 
// 	document.getElementById('layout_ui').style.display = 'none';
// 	document.getElementById('layout_ui_side').style.display = 'none';
// 	document.getElementById('layout_ui_nav').style.visibility = 'hidden';
// 	
// 	// default all elements
// 	var map = document.getElementById('layout_map');
// 	var parent = document.getElementById('layout_viewport');
// 	var bgdiv = document.getElementById('layout_pagewrap');
// 	
// 	// utility function to flush CSS  changes
// 	function flushCSS() { 
// 		map.offsetHeight;
// 		parent.offsetHeight;
// 		bgdiv.offsetHeight;
// 		}
// 		
// 	bgdiv.style.transition = "0s all";
// 	map.style.transition = "0s all";
// 	parent.style.transition = "0s all";
// 	flushCSS();
// 	
// 	// center the screen
// 	parent.scrollLeft = (map.clientWidth - parent.clientWidth) * 0.5;
// 	parent.scrollTop = (map.clientHeight - parent.clientHeight) * 0.5;
// 	bgdiv.style.backgroundPosition = '50% 50%';
// 	
// 	// fade from black
// 	map.style.opacity = '0.0';
// 	parent.style.backgroundColor = 'rgba(0,0,0,1)';
// 	flushCSS();
// 	
// 	// start zoomed out
// 	document.body.className += ' xtreme_zoom'; // icon view
// 	// turn this on if you want maximum bling. otherwise it hurts framerate too much
// // 	bgdiv.style.backgroundSize = "100% auto"; // parallax
// 	// we would prefer to use translate, but it causes weird GPU issues.
// // 	map.style.transform = 'translateZ(-50px) rotate(30deg)';
// 	map.style.transform = 'scale(0.01) rotate(30deg)';
// 	flushCSS();
// 	
// 	// animate stuff
// 	parent.style.transition = "background-color 16s ease-in-out";
// 	map.style.transition = " 20s all ease-in-out";
// 	bgdiv.style.transition = " 20s all ease-in-out";
// 	flushCSS();
// 	parent.style.backgroundColor = 'rgba(0,0,0,0.5)';
// 	// we would prefer to use translate, but it causes weird GPU issues.
// // 	map.style.transform = 'translateZ(-' + (0.5 / 0.075) + 'px)';
// 	map.style.transform = 'scale(0.075)';
// 	// turn this on if you want maximum bling. otherwise it hurts framerate too much
// // 	bgdiv.style.backgroundSize = '107% auto';
// 	map.style.opacity = '1.0';
// 	flushCSS();
// 	
// 	// TODO: change the background position to end up in the same spot as the sreen
// 	 
// 	// TODO: target a specific star instead of hacking in a percentage just for show.
// 	 
// 	// midpoint
// 	setTimeout( function() { 
// 		$('#flash_caret').show();
// 		
// 		setTimeout( function() { 
// 			document.body.className = document.body.className.replace('xtreme_zoom');
// 			}, 4000 );
// 
//         
// 		setTimeout( function() { 
// 			document.getElementById('layout_ui').style.display = 'flex';
// 			}, 19000 );
// 			
// 		setTimeout( function() { 
// 			document.getElementById('layout_ui_nav').style.visibility = 'visible';
// 			}, 20000 );
//         
// 		setTimeout( function() { 
// 			document.getElementById('layout_ui_side').style.display = 'block';
// 			$('#the_caret').show();
// 			}, 21000 );
//         
// 		parent.style.transition = "background-color 10s ease-in-out";
// 		map.style.transition = " 20s all ease-in-out";
// 		bgdiv.style.transition = " 20s all ease-in-out";
// 		flushCSS();
// 		parent.style.background = 'rgba(0,0,0,0)';
// 		map.style.transform = 'scale(1.0) translateX(43%) translateY(47%)';		
// // 		map.style.transform = 'translateZ(0) translateX(-15%) translateY(-15%)';
// 		map.style.opacity = '1.0';
// 		// turn this on if you want maximum bling. otherwise it hurts framerate too much
// // 		bgdiv.style.backgroundSize = '125% auto';
// // 		parent.scrollLeft = 0;
// // 		parent.scrollTop = 0;
// 		flushCSS();
// 		// reset everything
// 		bgdiv.style.transition = "0s all";
// 		map.style.transition = "0s all";
// 		parent.style.transition = "0s all";
// 		flushCSS();
// 		}, 22000 );
// 	
//  
// });

</script>





</template>
