<template containerless>
	<div id="audience_pane" class="pane" if.bind="civ && acct">
	
		<div id="audience_them" css="border-color: rgb( ${civ.color_rgb[0]}, ${civ.color_rgb[1]}, ${civ.color_rgb[2]} ); 
		background-color: rgba( ${civ.color_rgb[0]}, ${civ.color_rgb[1]}, ${civ.color_rgb[2]}, 0.55 );">
			<div class="diplo_img_wrapper trekIn" if.bind="ambassador_present">
				<div class="diplo_img ${mood}" css="background-image: url(${civ.diplo_img_small});"></div>
			</div>
			<h2><img class="flag" src.one-time="civ.flag_img" /> ${civ.name}</h2>
			<p class="button_rack">
				<button class="big">Relations</button>
				<button class="big">Info</button>
				<button class="big" if.bind="!ambassador_present" click.delegate="StartMeeting()" >Audience</button>
				<button class="big alt" if.bind="ambassador_present" click.delegate="Exit()" >Leave</button>
			</p>
			<div class="love_nub"><div class="nub" css="margin-left: calc(${acct.lovenub} * (100% - 6em));">${acct.lovenub|loveNub}</div></div>
			<p>
				<progress style="width: 100%; height: 8px; margin: 2px 0; color: 181;" value.bind="acct.attspan"></progress>
				<br/>Attention Span
			</p>
			<div class="trade_item_list" if.bind="app.game.myciv.diplo.contacts.get(civ).treaties.size">
				<div class="treaty" repeat.for="[type, treaty] of app.game.myciv.diplo.contacts.get(civ).treaties">
					${treaty.label}
					<span if.bind="type=='TRADE'" class="bold good"> (+$${treaty.income_last_turn})</span>
					<span if.bind="type=='RESEARCH'" class="bold good"> (+${treaty.income_last_turn} RP)</span>
				</div>
			</div>
			<p if.bind="app.options.debug">
				Communication: ${comm | starRating : '5' : 'â˜…' : '' : 'None' }<br/>
				Preferred Habitat: ${civ.race.env.atm} Atmosphere, ${civ.race.env.temp} Temperature, ${civ.race.env.grav} Gravity<br/>
				Style: ${c.diplo.style|round:2}<br/>
				Skill: ${civ.diplo.skill|round:2}<br/>
				Disposition: ${civ.diplo.dispo|round:2}<br/>
				Offer OK @ ${civ.diplo.offer_ok_at|round:2}<br/>
				Offer Counter @ ${civ.diplo.offer_counter_at|round:2}<br/>
				Offer Bad @ ${civ.diplo.offer_bad_at|round:2}<br/>
				Attention Span Recharge: ${civ.diplo.attspan_recharge|round:2}<br/>
				Attention Span Max: ${civ.diplo.attspan_max|round:2}<br/>
				Emotion: x${civ.diplo.emotion*2|round:2}
				Memory: ${civ.diplo.memory|round:2}<br/>
				Turns in Contact: ${(app.game.turn_num - acct.est) + 1}
			</p>	
		</div>
		
		<!-- INTRO -->
		<div id="audience_us" class="slideInRight" if.bind="ambassador_present && mode=='intro'">
			<div id="speech_them" class="fadeIn" css="color: ${civ.color};" if.bind="their_text">
				<p><b style="font-weight:bold;">${civ.name} Ambassador:</b><p>
				<div innerhtml.bind="their_text"></div>
			</div>
			<div id="speech_us" if.bind="our_text || options.length">
				<div innerhtml.bind="our_text"></div>
				<ol>
					<li repeat.for="option of options"><a href="#" click.delegate="option.func()">${option.text}</a></li>
				</ol>
			</div>
		</div>
		
		<!-- CREATE OFFER -->
		<div id="audience_us" class="createoffer" if.bind="ambassador_present && mode=='create_offer'">
			<!-- annoyed - go away -->
			<template if.bind="acct.attspan < 0.05" containerless>
				<div id="speech_them" class="fadeIn" css="color: ${civ.color};">
					<p><b style="font-weight:bold;">${civ.name} Ambassador:</b><p>
					<div>
						<p>We will hear no more offers today.</p>
					</div>
					<button class="big" click.delegate="ReturnToMainMenu()">OK</button>
				</div>
			</template>
			<!-- lets make a deal -->
			<template if.bind="acct.attspan >= 0.05" containerless>
				<div>
					<button class="right bad" click.delegate="ReturnToMainMenu()">CANCEL</button>
					<h2>Create an Offer</h2>
				</div>
				<div class="divide avail_items">
					<div>
						<div class="head">
							<h3>Give:</h3>
							<p class="button_rack button_rack_fill small">
								<button>All</button>
								<button>Cash</button>
								<button>Tech</button>
								<button>Treaties</button>
								<button>Planets</button>
							</p>
						</div>
						<div class="body trade_item_list">
							<div repeat.for="i of our_trade_items" class="${i.type} ${i.avail ? '' : 'ghost'}" 
								click.trigger="PutTradeItem(i,our_trade_items,offer.offer,$event)">${i.label}</div>
						</div>
					</div>
					<div>
						<div class="head">
							<h3>Ask:</h3>
						</div>
						<div class="body trade_item_list">
							<div repeat.for="i of their_trade_items" class="${i.type} ${i.avail ? '' : 'ghost'}" 
								click.trigger="PutTradeItem(i,their_trade_items,offer.ask,$event)">${i.label}</div>
						</div>
					</div>
				</div>
				<div class="divide tabled_items">
					<div class="trade_item_list">
						<div repeat.for="i of offer.offer" class="${i.type}" 
								click.trigger="PutTradeItem(i,offer.offer,our_trade_items,$event)">
								${i.label}
								<input if.bind="i.type=='cash' || i.type=='resource'" value.bind="i.amount" type="range" min="0" max.bind="i.max" class="pretty" />
								<output if.bind="i.amount" value.bind="i.amount"></output>
						</div>
					</div>
					<div class="trade_item_list">
						<div repeat.for="i of offer.ask" class="${i.type}" 
								click.trigger="PutTradeItem(i,offer.ask,their_trade_items,$event)">
								${i.label}
								<input if.bind="i.type=='cash' || i.type=='resource'" value.bind="i.amount" type="range" min="0" max.bind="i.max" class="pretty" />
								<output if.bind="i.amount" value.bind="i.amount"></output>
						</div>
					</div>
				</div>
				<p class="button_rack">
					<button class="big alt" click.delegate="SubmitOffer()">Make Offer</button>
					<button class="big bad" click.delegate="ReturnToMainMenu()">Cancel</button>
				</p>
			</template>
		</div>
		
		<!-- CONSIDER OFFER -->
		<div id="audience_us" if.bind="mode=='consider_offer'">
			<p style="text-align:center; font-size: 300%; margin-top: 3em;">Considering your offer...</p>
			<p style="text-align:center; font-size: 300%; margin-top: 3em;">
				<progress style="height: 1em; width: 10em;"/>
			</p>
			<p if.bind="app.options.debug">
				<b>${offer.score|round:3} SCORE </b><br/>
				${civ.diplo.offer_ok_at|round:3} Offer OK @ <br/>
				${civ.diplo.offer_counter_at|round:3} Offer Counter @<br/>
				${civ.diplo.offer_bad_at|round:3} Offer Bad @<br/>
				x${civ.diplo.emotion*2|round:3} Emotion
			</p>
		</div>
			
		<!-- OFFER COUNTERED -->
		<div id="audience_us" if.bind="mode=='offer_countered'">
			<div id="speech_them" class="fadeIn" css="color: ${civ.color};">
				<p><b style="font-weight:bold;">${civ.name} Ambassador:</b><p>
				<div innerhtml.bind="their_text"></div>
			</div>
			<div class="divide tabled_items">
				<div class="trade_item_list">
					<h3>We Give Them:</h3>
					<div repeat.for="i of offer.ask" class="${i.type}" 
							click.trigger="PutTradeItem(i,offer.ask,their_trade_items,$event)">
							${i.label}
							<input if.bind="i.type=='cash' || i.type=='resource'" value.bind="i.amount" type="range" min="0" max.bind="i.max" class="pretty" />
							<output if.bind="i.amount" value.bind="i.amount"></output>
					</div>
				</div>
				<div class="trade_item_list">
					<h3>They Give Us:</h3>
					<div repeat.for="i of offer.offer" class="${i.type}" 
							click.trigger="PutTradeItem(i,offer.offer,our_trade_items,$event)">
							${i.label}
							<input if.bind="i.type=='cash' || i.type=='resource'" value.bind="i.amount" type="range" min="0" max.bind="i.max" class="pretty" />
							<output if.bind="i.amount" value.bind="i.amount"></output>
					</div>
				</div>
			</div>			
			<p class="button_rack">
				<button click.delegate="AcceptOffer()" class="big">Accept</button>
				<button click.delegate="DeclineOffer()" class="big bad">Decline</button>
				<button click.delegate="CounterOffer()" class="big alt ${acct.attspan < 0.05 ? 'disabled' : ''}">Counter-Offer</button>
			</p>	
		</div>
		
	</div>
</template>
