<template>
	<div id="ship_des_pane" class="pane flex">
	
		<header>
			<div class="button_rack big" style="float:right;">
				<button click.delegate="StartNewBlueprint()" if.bind="mode!='new'" class="alt">NEW DESIGN</button>	
				<button click.delegate="CommitNewBlueprint()" if.bind="mode=='new'" class="alt ${newbp.mass > 0 ? '' : 'ghost'}">COMMIT DESIGN</button>
				<button click.delegate="CancelNewBlueprint()" if.bind="mode=='new'" class="bad">CANCEL DESIGN</button>
				<button click.delegate="ClosePanel()">CLOSE</button>
			</div>
			<h1>Ship Design</h1>
		</header>
		
		<main id="ship_des_pane_wrapper">
			
			<!-- ship list -->
			<div id="bp_list" class="offset unpadded iconlist" if.bind="!mode">
				<div repeat.for="shipbp of bps" 
					click.delegate="ClickBlueprint(shipbp)"
					class="item clickable ${bp==shipbp ? 'selected' : ''}"> 
					<img src.bind="shipbp.img" />
					<div class="info">
						<p>${shipbp.name}</p>
						<p class="subtext">
							${shipbp.sizeclass}-Class,  
							${shipbp.research ? 'Research' : ''}
							${shipbp.colonize ? 'Colonizer' : ''} 
							<span containerless if.bind="shipbp.fp">${shipbp.fp} Firepower</span>
						</p>
					</div>
				</div>
			</div>

			<!-- ship details pane -->
			<div id="bp_detail" class="offset" if.bind="bp && !mode">
				<div style="float:right; max-width: 20em; width: 20%; min-width: 100px; margin:0;" >
					<div class="button_rack button_rack_fill">
						<button click.delegate="CopyBlueprint()" if.bind="bp && !newbp && mode!='upgrade'" class="">COPY</button>
						<button click.delegate="mode='scrap'" if.bind="bp && !newbp && mode!='scrap'" class="bad">SCRAP</button>
					</div>
					<br/>
					<img src.bind="bp.img" class="zoomzoom" style="width: 100%; min-width: 100px;"/>
				</div>
				<h2>${bp.name} <span style="color:#4BA5CC;">${bp.sizeclass}-Class</span></h2>
				<p>Structure: <b>${bp.mass}</b> Mass, <b>${bp.hull}</b> Hull, <b>${bp.armor}</b> Armor,  <b>${bp.shield}</b> Shielding</p>
				<p>Costs: <span repeat.for="k of bp.cost|props" style="margin-right:1em; display:inline-block;">${k}:${bp.cost[k]}</span></p>
				<p>Discount: ${bp.bulk_discount}% (${bp.num_built} Made)</p>
				<p>Firepower: ${bp.fp}</p>
				<p>AI Threat: ${bp.milval}</p>
				<p>Map Speed: ${bp.speed}</p>
				<p>Combat Speed: ${bp.combatspeed}</p>
				<p>Colony Ship: ${bp.colonize ? 'YES' : 'NO'}</p>
				<p>Research Capacity: ${bp.research}</p>
			
				<h3>Weapons</h3>
				<table if.bind="bp.weapons.length">
					<tr repeat.for="w of bp.weapons">
						<td>x${w.qty}</td>
						<td>${w.name}</td>
						<td>${w.type}</td>
						<td>${w.mindmg}-${w.maxdmg}</td>
						<td>${w.shots}</td>
						<td>^${w.reload}</td>
						<td>~${w.accu}</td>
						<td>Costs: <span repeat.for="k of w.cost|props" style="margin-right:1em; display:inline-block;">${k}:${w.cost[k]}</span></td>
					</tr>
				</table>
				<p if.bind="!bp.weapons.length">None</p>
				
				<h3>Components</h3>
				<table if.bind="bp.comps.length">
					<tr repeat.for="c of bp.comps">
						<td><b>${c.name}</b></td>
						<td>${c.desc}</td>
						<td><span repeat.for="m of c.mods">${m.op}${m.val} ${m.abil} </span> </td>
						<td>Costs: <span repeat.for="k of c.cost|props" style="margin-right:1em; display:inline-block;">${k}:${c.cost[k]}</span></td>
					</tr>
				</table>			
				<p if.bind="!bp.comps.length">None</p>
			</div>
			
			
			<!-- new blueprint pane -->
			<div id="newbp" class="offset" if.bind="newbp && mode=='new'">
				<p>
					<input type="text" name="shipname" value.bind="newbp.name" />
				</p>
				<p>
					<progress max.one-time="max_hull_size" value.bind="newbp.mass || 0"></progress>
					<b>${(((newbp.mass||1) / max_hull_size ) * 100) | round}%</b> Maximum Capacity
				</p> 
				<div style="float:right; max-width: 12em; width: 20%; min-width: 100px; margin:0; max-height:10em" >
					<p class="button_rack button_rack_fill topless" style="text-align:center;">
						<button click.delegate="ClickPrevImg()">&nbsp;&nbsp;&nbsp;◀&nbsp;&nbsp;&nbsp;</button>
						<button click.delegate="ClickNextImg()">&nbsp;&nbsp;&nbsp;▶&nbsp;&nbsp;&nbsp;</button>
					</p>
					<img src.bind="newbp.img" class="zoomzoom" style="width: 100%; min-width: 100px;"/>
				</div>
				<h2>
					<span style="color:#4BA5CC;">${newbp.sizeclass}-Class</span>
				</h2>
				<p>Structure: <b>${newbp.mass}</b> Mass, <b>${newbp.hull}</b> Hull, <b>${newbp.armor}</b> Armor,  <b>${newbp.shield}</b> Shielding</p>
				<p>Costs: 
					<span repeat.for="k of ['labor','$','o','s','m','r','g','b','c','y','v']" style="margin-right:1em; display:inline-block;">
						<template containerless if.bind="newbp.cost[k]">${k}:${newbp.cost[k]}</template>
					</span>
				</p>
				<p>Firepower: ${newbp.fp}</p>
				<p>Map Speed: ${newbp.speed}</p>
				<p>Combat Speed: ${newbp.combatspeed}</p>
				<p>Colony Ship: ${newbp.colonize ? 'YES' : 'NO'}</p>
				<p>Research Capacity: ${newbp.research}</p>
			
				<h3>Weapons</h3>
				<table if.bind="newbp.weapons.length">
					<tr repeat.for="w of newbp.weapons">
						<td>
							<button class="bad bold" click.delegate="newbp.RemoveWeapon(w)">X</button>
							<button class="cool bold" click.delegate="DecWeaponQty(newbp,w)">-</button>
							<button class="cool bold" click.delegate="IncWeaponQty(newbp,w)">+</button>
						</td>
						<!-- 
							BUG: Aurelia doesn't rebind to weapons that are added, 
							removed, and re-added. Symptom: qty does not change
							even if +/- buttons are used, however, the actual data
							does change. Maybe there will be a fix one day.							
						-->
						<td>x${w.qty + force_update_shim*0}</td>
						<td>${w.name}</td>
						<td>${w.type}</td>
						<td>${w.mindmg}-${w.maxdmg}</td>
						<td>${w.shots}</td>
						<td>^${w.reload}</td>
						<td>~${w.accu}</td>
						<td>Costs: <span repeat.for="k of w.cost|props" style="margin-right:1em; display:inline-block;">${k}:${w.cost[k]}</span></td>
					</tr>
				</table>
				<p class="button_rack">
					<button click.delegate="subpanel='add_weapon'">Add Weapon</button>
				</p>
			
				<h3>Components</h3>
				<table if.bind="newbp.comps.length">
					<tr repeat.for="c of newbp.comps">
						<td>
							<button class="bad bold" click.delegate="newbp.RemoveComponent(c)">X</button>
						</td>
						<td><b>${c.name}</b></td>
						<td>${c.desc}</td>
						<td>Costs: <span repeat.for="k of c.cost|props" style="margin-right:1em; display:inline-block;">${k}:${c.cost[k]}</span></td>
						<td><span repeat.for="m of c.mods">${m.op}${m.val} ${m.abil} </span> </td>
					</tr>
				</table>
				<p class="button_rack">
					<button click.delegate="subpanel='add_comp'">Add Component</button>
				</p>
				
			</div>			

			<!-- scrap ship pane -->
			<div class="offset big" if.bind="mode=='scrap'" >			
				<h2>Scrap ${bp.name}</h2>
				<div style="float:right; max-width: 20em; width: 20%; min-width: 100px; margin:0;" >
					<img src.bind="bp.img"  style="width: 100%; min-width: 100px;"/>
				</div>
				<p><input type="checkbox" checked.bind="scrap_delete_all" /> Scrap all existing ships?
				<p><input type="checkbox" checked.bind="scrap_remove_from_queues" /> Remove from planetary build queues?
				<p>This will permanently remove this blueprint. Are you sure?</p>
				<p class="button_rack">
					<button class="" click.delegate="ScrapBlueprint()">SCRAP</button>
					<button class="bad" click.delegate="mode=null">CANCEL</button>
				</p>
			</div>
			
			<!-- add weapon pane -->
			<div id="add_weapon_pane" class="offset" if.bind="subpanel=='add_weapon'">
				<p class="button_rack topless" style="float:right;">
					<button class="big" click.delegate="subpanel=null">CLOSE</button>
				</p>
				<h3>Add Weapons:</h3>
				<table>
					<tr repeat.for="w of app.game.myciv.avail_ship_weapons">
						<td>
							<button class="" click.delegate="ClickAddWeapon(w)">Add</button>
						</td>
						<td><b>${w.name}</b></td>
						<td>${w.type}</td>
						<td>${w.mindmg}-${w.maxdmg}</td>
						<td>${w.shots}</td>
						<td>^${w.reload}</td>
						<td>~${w.accu}</td>
						<td>Costs: <span repeat.for="k of w.cost|props" style="margin-right:1em; display:inline-block;">${k}:${w.cost[k]}</span></td>
					</tr>
				</table>
			</div>
			
			<!-- add component pane -->
			<div id="add_component_pane" class="offset" if.bind="subpanel=='add_comp'">
				<p class="button_rack topless" style="float:right;">
					<button class="big" click.delegate="subpanel=null">CLOSE</button>
				</p>
				<h3>Add Components:</h3>
				<table>
					<tr repeat.for="c of app.game.myciv.avail_ship_comps">
						<td>
							<button class="" click.delegate="ClickAddComponent(c)">Add</button>
						</td>
						<td><b>${c.name}</b></td>
						<td>${c.desc}</td>
						<td><span repeat.for="m of c.mods">${m.op}${m.val} ${m.abil} </span> </td>
						<td>Costs: <span repeat.for="k of c.cost|props" style="margin-right:1em; display:inline-block;">${k}:${c.cost[k]}</span></td>
					</tr>
				</table>
			</div>
			
		</main>	
	</div>



</template>
