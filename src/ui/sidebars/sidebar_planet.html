<template>

	<div class="planet atm${planet.atm} tmp${planet.temp} grav${planet.grav}" css="min-height:${(planet.size)|idealplanetsize}px; background-size: auto ${(planet.size)|idealplanetsize}px; background-position: 50% -${planet.size/2}px ;"><!-- calc(100% + ${planet.size}px) -->
		
		<p class="button_rack button_rack_fill small">
			<button click.delegate="OpenDetailsPane()">INFO</button>
			<button click.delegate="PressStarButton()">STAR</button>
			<button click.delegate="PressPrevPlanetButton()">‚óÄ</button>
			<button click.delegate="PressNextPlanetButton()">‚ñ∂</button>
			<button if.bind="planet.owner == app.game.myciv"
				click.delegate="ToggleStagingPoint()" 
					class="${planet.star.accts.get(planet.owner).ai.staging_pt ? 'alt' : ''}">‚úúSTAGING</button>
		</p>
						
		<!-- enemy fleet attack option --> 
		<p class="button_rack button_rack_fill" if.bind="planet.settled && !planet.owner.is_player && playerHasLocalFleet">
			<button class="alt" click.delegate="AttackTargetWithLocalFleet()">ATTACK</button>
		</p>
		
		<!-- NOTE: using one-time binding to avoid brief moment when the 
		object is undefined and browser tries to ask server for 'undefined' -->
<!-- 		<img if.bind="planet.owner" class="flag" src.bind="planet.owner.flag_img" /> -->
		<h2 if.bind="planet.owner" css="
		background-image: linear-gradient( to right, 
			rgba(${planet.owner.color_rgb[0]},${planet.owner.color_rgb[1]},${planet.owner.color_rgb[2]},0) 0%     ,
			rgba(${planet.owner.color_rgb[0]},${planet.owner.color_rgb[1]},${planet.owner.color_rgb[2]},1) 25%    ,
			rgba(${planet.owner.color_rgb[0]},${planet.owner.color_rgb[1]},${planet.owner.color_rgb[2]},1) 75%    ,
			rgba(${planet.owner.color_rgb[0]},${planet.owner.color_rgb[1]},${planet.owner.color_rgb[2]},0) 100%
			);
		">${planet.name}</h2>
		<h2 if.bind="!planet.owner">${planet.name}</h2>
		<p class="age" if.bind="planet.age_level">${'üüä'.repeat(planet.age_level)}</p>
		<div class="phys">
	
			<p class="env_label">${planet.gravDisplayName} ${planet.envDisplayName}</p>
			
			<div class="size">
				<span class="pop" if.bind="planet.owner !== false">${planet.total_pop|round} / ${planet.maxpop|round}<br/><span class="pop">POPULATION</span></span>
				<span class="size">${planet.size}<br/><span class="size">SIZE</span></span>
				<span class="en">${planet.energy}<br/><span class="en">ENERGY</span></span>			
				<span class="${habitable ? (habitat < 0 ? 'alert' : 'good') : 'bad'}">	
					${(habitat >= 0 ? '+' : '')}${habitat}<br /> 
					<span class="">${habitable ? "HABITABILITY" : "UNINHABITABLE"}</span>
				</span>
				<span if.bind="planet.owner !== false">
					<img src.bind="planet.morale | moraleToMoodIcon"  style="width: 1.1em; height: 1.1em;" /><br/>
				</span>
			</div>
			<div class="resources">
				<template repeat.for="k of planet.resources|props" containerless>
					<span repeat.for="i of planet.resources[k]" class="${k}"></span>
				</template>
			</div>
			
		</div> 
		
		<template containerless if.bind="app.options.see_all || planet.owner == app.game.myciv">
			
			<!-- Spending Levels -->
			<div class="spending " if.bind="planet.owner">
				<div class="t"><span>TAX</span><input type="range"  min="0" max="0.5" step="0.01" value.bind="planet.slider_taxrate" /><span>${planet.tax_rate | percent}%</span></div> 
				<div class="th"><span>SPEND</span><input type="range" min="0" max.bind="planet.max_spending" step="0.01" value.bind="planet.slider_spending" /><span>${planet.spending | percent}%</span></div> 
			</div>
			
			<!-- zoning -->
			<div class="zones" if.bind="planet.owner">
				<template containerless repeat.for="z of planet.zones">
					<div repeat.for="s of z.size" click.delegate="ClickZone(z)"
						class="zone clickable ${z==sel_zone?'hilite':''} ${z.type} ${z.key} 
						${z.insuf ? 'insuf' : ''}
						${z.size==1 ? 'only' : ( s==0 ? 'start' : (s==z.size-1 ? 'end' : 'mid') ) }
						pct${z.val|round:1|percent}
						">
					</div>
				</template>
				<div repeat.for="z of (planet.size - planet.zoned)" class="zone empty" click.delegate="ClickEmptyZone()"></div>
			</div>
			
			<!-- zone detail -->
			<div class="zone_detail wrapper ${sel_zone.type} ${sel_zone.key}" if.bind="planet.owner && sel_zone && !show_add_zone_panel">
				<div>
					<p class="name">${sel_zone.name}</p>
					<p class="type">${sel_zone.type}</p>
					<p class="desc">${sel_zone.desc}</p>
					<p class="stats">	
						Size: <b>${sel_zone.size}</b>
						<br/>
						Matures In: <b>${(1-sel_zone.val) / (1/(sel_zone.gf * planet.zone_hab_mod)) | ceil} turns</b> &nbsp;
						<br/>
						<!-- could also use zone.resource_rec data here -->
						Costs [<span class="k" repeat.for="k of sel_zone.resource_estm|props">${k|uppercase}:<b>${sel_zone.resource_estm[k]|round:1}</b>&nbsp;</span>]
						<br/>
						Output [<span class="k" repeat.for="k of sel_zone.output_rec|props">${k|uppercase}:<b>${sel_zone.output_rec[k]|round:1}</b>&nbsp;</span>]
					</p>
					<p if.bind="sel_zone.insuf" class="nag bad">‚ö†Ô∏è Zone in Decline</p>
				</div>
				<div>
					<div class="zone ${sel_zone.type} ${sel_zone.level} ${sel_zone.key} only"></div>
					<div class="button_rack button_rack_fill">
						<button class="bad" click.delegate="RemoveZone()" if.bind="!sel_zone.perma">DEMOLISH</button>
					</div>
				</div>
			</div>
			
			<!-- add-zone selection detail -->
			<div class="wrapper" if.bind="planet.owner && zone_to_add && show_add_zone_panel && planet.size - planet.zoned > 0">
				<select value.bind="zone_to_add" class="select-css" style="width:100%; margin-bottom:1em;">
					<option repeat.for="z of app.game.myciv.avail_zones" model.bind="z"
						disabled.bind="z.size > (planet.size - planet.zoned)"
						class="${z.type}"
						>${z.type|uppercaseFirst}: ${z.name}</option>
				</select>	
				<div class="zone_detail ${zone_to_add.size <= (planet.size - planet.zoned) ? 'available' : 'unavailable'}">
					<div>
						<p class="name">${zone_to_add.name}</p>
						<p class="type">${zone_to_add.type}</p>
						<p class="desc">${zone_to_add.desc}</p>
						<p class="stats">	
							Size: <b>${zone_to_add.size}</b><br/>
							Matures In: <b>${zone_to_add.gf * planet.zone_hab_mod | ceil} turns</b> &nbsp;
							<br/>
							Costs [<span class="k" repeat.for="k of zone_to_add.inputs|props">${k|uppercase}:<b>${zone_to_add.inputs[k]|round:1}</b>&nbsp;</span>]
							<br/>
							Output [<span class="k" repeat.for="k of zone_to_add.outputs|props">${k|uppercase}:<b>${zone_to_add.outputs[k]|round:1}</b>&nbsp;</span>]
						</p>
					</div>
					<div>
						<div class="zone ${zone_to_add.type} ${zone_to_add.key} only"></div>
						<div class="button_rack button_rack_fill " if.bind="zone_to_add.size <= planet.size - planet.zoned">
							<button click.delegate="AddZone()">ADD</button>
						</div>
					</div>
				</div>	
			</div>
			
			<!-- Colony Data -->
			<div class="data wrapper" if.bind="planet.owner">
				<span class="${k}" repeat.for="k of ['$','o','s','m','r','g','b','c','v','y','ship','def','esp','res','def','gov','hou']"
					style="width: 23%; margin: 0.5%; padding: 0.5%; border-radius:2px; display: inline-block; height:0.8em;line-height:0.8em;">
					${k|uppercase}:
					<b style="color:#D11;" if.bind="planet.resource_rec[k] > 0">-${planet.resource_rec[k]|ceil}</b>
					<b style="color:#AEA;" if.bind="planet.output_rec[k] > 0">+${planet.output_rec[k]|ceil}</b>
				</span>
				<span class="" style="width: 23%; margin: 0.5%; padding: 0.5%; border-radius:2px; display: inline-block; height:0.8em;line-height:0.8em;">
					TAX: <b style="color:#AEA;">+${planet.econ.tax_rev|ceil}</b>
				</span>				
				<span class="" style="width: 23%; margin: 0.5%; padding: 0.5%; border-radius:2px; display: inline-block; height:0.8em;line-height:0.8em;">
					GDP: <b>${planet.econ.GDP|round:1}</b>
				</span>				
				<span class="" style="width: 23%; margin: 0.5%; padding: 0.5%; border-radius:2px; display: inline-block; height:0.8em;line-height:0.8em;">
					PCI: <b>${planet.econ.PCI|round:1}</b> ‚ûû <b>${planet.econ.target_PCI|round:1}</b>
				</span>				
				<span class="" style="width: 23%; margin: 0.5%; padding: 0.5%; border-radius:2px; display: inline-block; height:0.8em;line-height:0.8em;">
					Morale: <b>${planet.morale|percent}%</b>
				</span>
			</div>
			
			<div class="wrapper" if.bind="planet.owner">
				<h3>Now Building:</h3>
				<table class="prod_queue">
					<tr repeat.for="item of planet.prod_q">
						<td>${item.turns_left >= 999 ? '-' : item.turns_left}</td>
						<td><progress max="100" value="${item.pct*100|floor}"></progress><p>${item.name}</p></td>
						<td><a href="#" click.delegate="BuildQueueMoveItemUp($index)" if.bind="$index > 0">‚ñ≤</a></td>
						<td><a href="#" click.delegate="BuildQueueMoveItemDown($index)" if.bind="$index != (planet.prod_q.length-1)">‚ñº</a></td>
						<td>
							<select value.bind="item.qty" style="width:3em;">
								<option repeat.for="option of prod_q_repeat_vals" model.bind="option.value">${option.name}</option>
							</select>			
						</td>
						<td><a href="#" click.delegate="BuildQueueRemoveItem($index)" class="bad">X</a></td>
					</tr>
				</table>
				<p>
					<select value.bind="sel_build_item" style="display:inline-block;">
						<option repeat.for="bp of planet.owner.ship_blueprints" model.bind="bp">${bp.name}</option>
						<option repeat.for="bp of planet.owner.groundunit_blueprints" model.bind="bp">${bp.name}</option>
						<option repeat.for="bp of planet.ListMakeworkProjects()" model.bind="bp">${bp.name}</option>
					</select>
					<button click.delegate="AddSelectedItemToBuildQueue()">Add</button>
				</p>
				<p class="clickable" click.delegate="OpenDetailsPane()">Send newly built ships to: 
					<b>${
						planet.ship_dest == '@' 
						? 'Nearest Staging Point'
						: (
							!planet.ship_dest 
							? 'Here'
							: planet.ship_dest.name
							) 
					}</b>
				</p>
			</div>
			
			<div class="defenses wrapper" if.bind="planet.owner">
				<h3>Defenses:</h3>
				<div repeat.for="[bp,count] of planet.ListUniqueGroundUnits()" style="display:inline-block;">
					<img src="img/ground/tank_transp.png" 
						style="
							height: 32px; 
							width: 32px; 
							display: inline-block; 
							border: 1px solid white; 
							border-radius: 0.25em; 
							overflow: hidden; 
							padding: 0.25em; 
							"
					/>&nbsp;x${count}&nbsp;
				</div>
			</div>
		</template>
		
	</div>
</template>
