<template containerless>
	
	<!-- FLEET DISPLAY MODE -->
	<div class="fleet" if.bind="mode == 'fleet'">

		<h2 css="color: ${fleet.owner.color};">${fleet.owner.name} Fleet #${fleet.id}</h2>
		
		<p style="font-size: 150%;" class="big" if.bind="fleet.mission">On Mission. Back in [${fleet.mission.time}] turns.</p>
		
		<p class="big topless" if.bind="!fleet.mission">
			<span if.bind="fleet.star" class="clickable" click.delegate="app.FocusMap(fleet.star)">@${fleet.star.name}</span>
			<span if.bind="fleet.dest && (app.options.see_all || fleet.owner.is_player)" 
				class="clickable" click.delegate="app.FocusMap(fleet.dest)">
				<span>‚û†</span> ${fleet.dest.name}
				<span class="bold" style="color: #FF9F00;">
					${fleet.dest_line_length / fleet.speed | ceil} turn${(fleet.dest_line_length / fleet.speed <= 1) ? '' : 's' }
				</span>
			</span>
			<p if.bind="fleet.ai && app.options.debug">
				AI: ${fleet.ai.type} =&gt; ${fleet.ai.target.name},	TTL.${fleet.ai.ttl == -1 ? '‚àû' : fleet.ai.ttl} DL.${fleet.ai.delay}
				<br/>
				:: ${fleet.ai.note}
			</p>
		</p>
		
		<p>
			<b style="color: #1BD;">‚Æû${fleet.speed|round}&nbsp;</b>
			<b style="color: #F33;">‚ö°${fleet.milval|round}&nbsp;</b>
			<b style="color: #AEA;" show.bind="fleet.research">‚öõ${fleet.research}&nbsp;</b>
			<b style="color: #FF9F00;" class="clickable" show.bind="fleet.troops" click.delegate="show_defenses = !show_defenses">‚ò†${fleet.troops}&nbsp;</b>
			<b style="color: #FF0;" show.bind="can_colonize">‚öë&nbsp;</b>
			<b style="color: #F33;" if.bind="fleet.fp" >
				‚öî<progress max="1.0" value.bind="fleet.fp_remaining / fleet.fp" style="width: 4em; height: 0.7em; color: #F33;"></progress>&nbsp;
			</b>
			<b style="color: #8B8;" if.bind="fleet.healthmax">
				‚úö<progress max="1.0" value.bind="fleet.health / fleet.healthmax" style="width: 4em; height: 0.7em; color: #8B8;"></progress>&nbsp;
			</b>
		</p>
		
		<div class="defenses wrapper" if.bind="app.game.turn_num && show_defenses && (app.options.see_all || fleet.owner.is_player)">
			<div repeat.for="[bp,count] of fleet.ListUniqueGroundUnits()" style="display:inline-block;">
				<img src.bind="bp.img" title.bind="bp.name"
					style="
						height: 32px; 
						width: 32px; 
						display: inline-block; 
						border: 1px solid white; 
						border-radius: 0.25em; 
						overflow: hidden; 
						padding: 0.25em; 
						"
				/>&nbsp;x${count}&nbsp;
			</div>
		</div>
					
		<!-- local anomoly research info -->
		<p class="centered" if.bind="fleet.star && !fleet.dest && fleet.star.objtype == 'anom' && (app.options.see_all || fleet.owner.is_player)">
			Anomaly Research: ${(app.game.turn_num*0) + fleet.star.AmountResearched( fleet.owner ) / fleet.star.size | percent}% 
			<progress value.bind="(app.game.turn_num*0) + fleet.star.AmountResearched( fleet.owner ) / fleet.star.size" />
		</p>
			
		<!-- enemy fleet attack option --> 
		<p class="button_rack button_rack_fill" if.bind="!fleet.owner.is_player && fleet.star && playerHasLocalFleet">
			<button class="alt" click.delegate="AttackTargetWithLocalFleet()">ATTACK</button>
		</p>
		
		<!-- show fleet actions if not on a deep space mission -->
		<template containerless if.bind="!fleet.mission && (fleet.owner.is_player || app.options.see_all)">
			<p class="msg" style="font-weight:bold; color: #FAA;">
				<span show.bind="can_send==2">Right-click a star to move fleet</span>&nbsp;
			</p>
			
			<!-- Fleet Actions -->
			<p class="button_rack fill marginless">
				<button click.delegate="ClickMove()" class="${can_send==2 ? (waiting_for_starclick ? 'bad' : '') : 'ghost'}">${waiting_for_starclick ? 'WHERE?' : 'MOVE'}</button>
				<button click.delegate="ClickAttack()" class="${fleet.fp_remaining && fleet.star && fleet.star.fleets.length > 1 && !waiting_for_starclick ? '' : 'ghost'}">ATTACK</button>
				<button click.delegate="ClickInvade()" class="${can_invade==2 && !waiting_for_starclick ? '' : 'ghost'}" >INVADE</button>
			</p>
			<p class="button_rack fill topless" >
				<button click.delegate="ClickColonize()" class="${can_colonize==2 && !waiting_for_starclick ? '' : 'ghost'}">COLONIZE</button>
				<button click.delegate="ClickChooseMission()" class="${can_research==2 && !waiting_for_starclick ? '' : 'ghost'}">MISSION</button>
				<button click.delegate="ClickTransferTroops()" class="${(can_pickup_troops || can_drop_troops) && !waiting_for_starclick ? '' : 'ghost'}" >TROOPS</button>
			</p>
			
			<!-- Ship Selection --> 
			<p class="button_rack fill topless" if.bind="fleet.owner.is_player" >
				<button click.delegate="SelectAll()" class="cool ${num_selected==fleet.ships.length ? 'ghost' : ''}">ALL</button>
				<button click.delegate="SelectNone()" class="cool ${num_selected ? '' : 'ghost'}">NONE</button>
				<button click.delegate="SelectInvert()" class="cool">INVERT</button>
				<button click.delegate="ClickInfo()" class="cool" >INFO</button>
				<button click.delegate="ClickClose()" class="cool" >CLOSE</button>
				<!-- <button click.delegate="ClickScrap()" class="cool ${num_selected ? '' : 'ghost'}" >SCRAP</button> -->
			</p>
		</template>
		 
		<!-- ship list for player view -->
		<div if.bind="fleet.owner.is_player || app.options.see_all"
			class="shipgrid ${app.options.ship_scaling ? 'dynasize' : ''} pack_${ship_grid_packing}x">
			<div class="ship ${ship.selected ? 'selected' : ''} health_${ship.health_class} size_${ship.bp.sizeclass}" 
				click.delegate="ClickShip(ship,$event)" 
				repeat.for="ship of fleet.ships" 
				>
				<p class=" top">
					<span>${ship.bp.colonize ? 'üÖ≤' : ''} ${ship.bp.research ? 'üÜÅ' : ''}</span>
					<span>${'üüä'.repeat(ship.xplevel)}</span>
					<b>${ship.bp.sizeclass}</b>
				</p>
				<img src.one-time="ship.bp.img" />
				<p class="center">
					<span>${ship.bp.hull}</span>&nbsp;/&nbsp;<span>${ship.bp.armor}</span>&nbsp;/&nbsp;<span>${ship.bp.shield}</span>
				</p>
				<progress if.bind="ship.armor" max="100" value="${((ship.armor / ship.bp.armor)*100)|round}" class="${ship.health_class}"></progress>
				<progress if.bind="!ship.armor" max="100" value="${((ship.hull / ship.bp.hull)*100)|round}" class="${ship.health_class}"></progress>
				<p class="name">${ship.bp.name} </p>
			</div>
		</div>
		
		<!-- ship summary for unprivileged enemy fleet views -->
		<div else>
			<p repeat.for="[bp,count] of fleet.ListUniqueModels()" style="vertical-align:top;">
				<img src.one-time="bp.img" style="height:4em; width:4em; object-fit: contain;vertical-align:top;"  />
				<b>${count}</b> ${bp.name}
			</p>
		</div>	
		
	</div>
		
	<div class="fleet" if.bind="mode=='mission' && !fleet.mission" style="font-weight:bold; font-size: 150%;">
		<p>Send fleet on deep-space research mission? Fleet will be unavailable until it returns.</p>
		<p>How long should the mission last?</p>
		<p><input type="range" min="3" max="50" step="1" value.bind="mission_turns" /> ${mission_turns} turns</p>
		<p class="button_rack">
			<button click.delegate="ClickStartMission()" class="good" >START MISSION</button>
			<button click.delegate="ClickCancel()" class="bad" >CANCEL</button>
		</p>
	</div>
		
	<!-- CHOOSE ATTACK TARGET MODE -->
	<div class="" if.bind="mode=='attack' && !fleet.mission">
		<h2>Choose Target:</h2>
		<div repeat.for="f of fleet.star.fleets" 
			if.bind="!f.owner.is_player && f.ships.length && !f.killme"
			click.delegate="SelectAttackTarget(f)" >
			<p>
				<img src.bind="f.owner.flag_img" style="max-height: 3em; float: right;"/>
				<b>${f.owner.name} Fleet</b><br/>
				<span class="green">${f.ships.length}</span> ships
				<span class="green">${f.fp}</span> firepower
				<span class="green">${f.bulk}</span> mass
			</p>
			<div>
				<div repeat.for="[bp,count] of f.ListUniqueModels()" style="display:inline-block;">
					<img src.one-time="bp.img" style="height:2em; width:2em; object-fit: contain;"  />x${count}&nbsp;
				</div>
			</div>
		</div>
		<p>
			<button class="bad" click.delegate="ClickCancelChooseAttackTarget()">CANCEL</button>
		</p>
	</div>
		
	<!-- CHOOSE-PLANET MODE -->
	<div class="star star_${fleet.star.color}" if.bind="mode == 'colonize'">
		<h2>Colonize ${fleet.star.name}</h2>
		<p style="font-weight:bold; color: #FAA;" >Choose a planet to colonize:</p>
		<div repeat.for="p of fleet.star.planets" class="smallplanetbg hilite_wrapper smallplanetbg" if.bind="!p.owner && p.Habitable(fleet.owner.race)" click.delegate="ChoosePlanetToColonize(p)">
			<div class="planet atm${p.atm} tmp${p.temp} grav${p.grav}" css.one-time="PlanetSizeCSS(p)">
				<h3 css="color: ${p.ui_color};">${p.name}</h3>
				<p class="env_label" style="font-size: 80%; text-align:left; float:none; width: 100%">${p.gravDisplayName}  ${p.envDisplayName}</p>
				<div class="physattrs marginless" style="font-size: 80%; color: #999;">
					<span repeat.for="a of p.physattrs" title.bind="a.desc">‚òÖ${a.name} </span>
				</div>			
				<div class="phys">
					<div class="size" style="margin: 0; padding: 0;">
						<span class="size">${p.size}<br/><span class="size">SIZE</span></span>							
						<span class="en">${p.energy}x<br/><span class="en">ENERGY</span></span>
						<span class="${p.Habitable(app.game.myciv.race) ? (p.Adaptation( app.game.myciv.race ) < 0 ? 'alert' : 'good') : 'bad'}">
							${(p.Adaptation( app.game.myciv.race ) >= 0 ? '+' : '')}${p.Adaptation( app.game.myciv.race )}<br/>
							<span class="">ENV</span>
						</span>	
					</div>
					<div class="resources">
						<template repeat.for="k of p.resources|props" containerless>
							<span repeat.for="i of p.resources[k]" class="${k}"></span>
						</template>
					</div>					
				</div>
			</div>
		</div>
		<p class="button_rack">
			<button  click.delegate="ClickCancel()" class="bad">CANCEL</button>
		</p>		
	</div>
		
	<!-- TROOP TRANSFER MODE -->
	<div class="star star_${fleet.star.color}" if.bind="mode == 'troopswap'">
		<h2>Transfer Troops</h2>
		
		<p class="button_rack button_rack_fill">
			<button click.delegate="ClickCancel()" class="">DONE</button>
		</p>	
		
		<template containerless if.bind="fleet.star">
			
			<progress min="0" max.bind="fleet.troopcap" value.bind="fleet.troops" 
				style="width: 100%;" 
				class="short topless ${fleet.troops==fleet.troopcap ? 'full' : ''}">
			</progress>
			<p if.bind="!trooplist.length" class="centered">No Troops In Fleet</p>
			<div class="trooplist">
				<img src.bind="t.bp.img" title.bind="t.bp.name"
					style="
						height: 32px; 
						width: 32px; 
						display: inline-block; 
						border: 1px solid white; 
						border-radius: 0.25em; 
						overflow: hidden; 
						padding: 0.25em; 
						margin: 0 0.5em 0.5em 0;
						"
					repeat.for="t of trooplist"
					click.trigger="ClickTroop(t,fleet)"
				/>
			</div>
			
			<p class="button_rack button_rack_fill"> 
				<button class="" click.delegate="TransferTroopsFromPlanet()">‚ñ≤</button>
				<button class="" click.delegate="TransferTroopsToPlanet()">‚ñº</button>
			</p>
			
			<div repeat.for="p of fleet.star.planets" 
				class="smallplanetbg hilite_wrapper ${p==selected_planet ? 'selected' : ''}" 
				if.bind="p.owner && p.owner == fleet.owner"
				click.delegate="ClickPlanetForTroops(p)"
				>
				<div class="planet atm${p.atm} tmp${p.temp}" css.one-time="PlanetSizeCSS(p)">
					<p css="color: ${p.ui_color}; font-weight:bold;">${p.name}</p>
					<div class="trooplist">
						<img src.bind="t.bp.img" title.bind="t.bp.name"
							style="
								height: 32px; 
								width: 32px; 
								display: inline-block; 
								border: 1px solid white; 
								border-radius: 0.25em; 
								overflow: hidden; 
								padding: 0.25em; 
								margin: 0 0.5em 0.5em 0;
								"
							repeat.for="t of p.troops"
							click.trigger="ClickTroop(t,p)"
						/>
					</div>
					
				</div>
			</div>
		</template>	
	</div>
	
	<!-- INVASION PLANET SELECTOR -->
	<div class="star star_${fleet.star.color}" if.bind="mode=='invade'">
		
		<p class="button_rack button_rack_fill">
			<button click.delegate="ClickCancel()" class="bad">CANCEL</button>
		</p>	
		
		<template containerless if.bind="fleet.star">
			<p>Our Forces:</p>
			<div repeat.for="[bp,count] of fleet.ListUniqueGroundUnits()" style="display:inline-block;">
				<img src.bind="bp.img" title.bind="bp.name"
					style="
						height: 32px; 
						width: 32px; 
						display: inline-block; 
						border: 1px solid white; 
						border-radius: 0.25em; 
						overflow: hidden; 
						padding: 0.25em; 
						"
				/>&nbsp;x${count}&nbsp;
			</div>
			
			<h2>Invade Which?</h2>
			<div repeat.for="p of fleet.star.planets" 
				class="smallplanetbg hilite_wrapper ${p==selected_planet ? 'selected' : ''}" 
				if.bind="p.owner && p.owner != fleet.owner"
				click.delegate="ClickPlanetToInvade(p)"
				>
				<div class="planet atm${p.atm} tmp${p.temp}" css.one-time="PlanetSizeCSS(p)">
					<p>
						<span css="color: ${p.ui_color}; font-weight:bold;">${p.name}</span> 
						Odds: <b>${CalculateChanceOfGroundVictory(p) * 100 | round}%</b>
					</p>
					<div repeat.for="[bp,count] of p.ListUniqueGroundUnits()" style="display:inline-block;">
						<img src.bind="bp.img" title.bind="bp.name"
							style="
								height: 32px; 
								width: 32px; 
								display: inline-block; 
								border: 1px solid white; 
								border-radius: 0.25em; 
								overflow: hidden; 
								padding: 0.25em; 
								"
						/>&nbsp;x${count}&nbsp;
					</div>		
				</div>
			</div>
		</template>
		
	</div>
	
</template>
