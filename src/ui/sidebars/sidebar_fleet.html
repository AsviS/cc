<template>
<!--	<require from="./converters/percent"></require>
	<require from="./converters/round"></require>-->
	<!-- FLEET DISPLAY MODE -->
	<div class="fleet" if.bind="mode == 'fleet' || mode == 'awaiting_star_click'">
		<h2 css="color: ${fleet.ui_color};">${fleet.owner.name} Fleet #${fleet.id}</h2>
		
		<p style="font-size: 150%;" class="big" if.bind="fleet.mission">On Mission. Back in [${fleet.mission.time}] turns.</p>
		
		<p style="" class="big topless" if.bind="!fleet.mission">
			<span if.bind="fleet.star">@${fleet.star.name}</span>
			<span if.bind="fleet.dest && (app.options.see_all || fleet.owner.is_player)">
				<span>‚û†</span> ${fleet.dest.name}
				<span class="bold" style="color: #FF9F00;">
					${fleet.dest_line_length / fleet.speed | ceil} turn${(fleet.dest_line_length / fleet.speed <= 1) ? '' : 's' }
				</span>
			</span>
		</p>
		
		<p>
			<b style="color: #F33;">‚ö°${fleet.milval|round}&nbsp;</b>
			<b style="color: #AEA;" show.bind="fleet.research">‚öõ${fleet.research}&nbsp;</b>
			<b style="color: #FF9F00;" show.bind="fleet.troops">‚ò†${fleet.troops}&nbsp;</b>
			<b style="color: #FF0;" show.bind="can_colonize">‚öë&nbsp;</b>
			<b style="color: #F33;" if.bind="fleet.fp" >
				‚öî<progress max="1.0" value.bind="fleet.fp_remaining / fleet.fp" style="width: 4em; height: 0.7em; color: #F33;"></progress>&nbsp;
			</b>
			<b style="color: #8B8;" if.bind="fleet.healthmax">
				‚úö<progress max="1.0" value.bind="fleet.health / fleet.healthmax" style="width: 4em; height: 0.7em; color: #8B8;"></progress>&nbsp;
			</b>
		</p>
		
		<!-- local anomoly research info -->
		<p if.bind="fleet.star && !fleet.dest && fleet.star.objtype == 'anom' && (app.options.see_all || fleet.owner.is_player)">
			Anomaly Research: ${(app.game.turn_num*0) + fleet.star.AmountResearched( fleet.owner ) / fleet.star.size | percent}% 
			<progress value.bind="(app.game.turn_num*0) + fleet.star.AmountResearched( fleet.owner ) / fleet.star.size" />
		</p>
			
		<!-- enemy fleet attack option --> 
		<p class="button_rack button_rack_fill" if.bind="!fleet.owner.is_player && fleet.star && playerHasLocalFleet">
			<button class="alt" click.delegate="AttackTargetWithLocalFleet()">ATTACK</button>
		</p>
		
		<!-- show fleet actions if not on a deep space mission -->
		<template containerless if.bind="!fleet.mission && (fleet.owner.is_player || app.options.see_all)">
			<p class="msg" style="font-weight:bold; color: #FAA;">
				<span show.bind="can_send==2">Right-click a star to move fleet</span>&nbsp;
			</p>
			
			<!-- Fleet Actions -->
			<p class="button_rack button_rack_fill">
				<button click.delegate="ClickColonize()" if.bind="can_colonize" class="${can_colonize==2 ? 'alt' : 'ghost'}">COLONIZE</button>
				<button click.delegate="ClickChooseMission()" if.bind="can_research" class="${can_research==2 ? 'alt' : 'ghost'}">MISSION</button>
				<button click.delegate="ClickTransferTroops()" if.bind="can_pickup_troops || can_drop_troops" >TROOPS</button>
				<button click.delegate="ClickAttack()" class="alt" if.bind="app.options.see_all && fleet.fp_remaining && fleet.star && fleet.star.fleets.length > 1"">ATTACK</button>
				<button click.delegate="ClickBomb()" if.bind="can_bomb && app.options.see_all" class="${can_bomb==2 ? 'alt' : 'ghost'}">BOMBARD</button>
				<button click.delegate="ClickInvade()" if.bind="can_invade && app.options.see_all" class="${can_invade==2 ? 'alt' : 'ghost'}" >INVADE</button>
			</p>
			
			<!-- Ship Selection --> 
			<p class="button_rack button_rack_fill" if.bind="fleet.owner.is_player">
				<button click.delegate="ClickClose()" class="" >CLOSE</button>
				<button click.delegate="SelectAll()" class="${num_selected==fleet.ships.length ? 'ghost' : ''}">ALL</button>
				<button click.delegate="SelectNone()" class="${num_selected ? '' : 'ghost'}">NONE</button>
				<button click.delegate="SelectInvert()" class="${num_selected ? '' : 'ghost'}">INVERT</button>
				<button click.delegate="ClickScrap()" class="${num_selected ? '' : 'ghost'}" >SCRAP</button>
<!-- 					<span>${num_selected}/${fleet.ships.length}</span> -->
			</p>
		</template>
		
		
		
		<!-- ship list -->
		<div class="shipgrid ${app.options.ship_scaling ? 'dynasize' : ''} pack_${ship_grid_packing}x">
			<div class="ship ${ship.selected ? 'selected' : ''} health_${ship.health_class} size_${ship.bp.sizeclass}" click.delegate="SelectShip(ship)" repeat.for="ship of fleet.ships" >
				<p class=" top">
					<span>${ship.bp.colonize ? 'üÖ≤' : ''} ${ship.bp.research ? 'üÜÅ' : ''}</span>
					<span>${'üüä'.repeat(ship.xplevel)}</span>
					<b>${ship.bp.sizeclass}</b>
				</p>
				<img src.one-time="ship.bp.img" />
				<p class="center">
					<span>${ship.bp.hull}</span>&nbsp;/&nbsp;<span>${ship.bp.armor}</span>&nbsp;/&nbsp;<span>${ship.bp.shield}</span>
				</p>
				<progress if.bind="ship.armor" max="100" value="${((ship.armor / ship.bp.armor)*100)|round}" class="${ship.health_class}"></progress>
				<progress if.bind="!ship.armor" max="100" value="${((ship.hull / ship.bp.hull)*100)|round}" class="${ship.health_class}"></progress>
				<p class="name">${ship.bp.name} </p>
			</div>
		</div>
	</div>
		
	<div class="fleet" if.bind="mode=='mission' && !fleet.mission" style="font-weight:bold; font-size: 150%;">
		<p>Send fleet on deep-space research mission? Fleet will be unavailable until it returns.</p>
		<p>How long should the mission last?</p>
		<p><input type="range" min="3" max="50" step="1" value.bind="mission_turns" /> ${mission_turns} turns</p>
		<p class="button_rack">
			<button click.delegate="ClickStartMission()" class="good" >START MISSION</button>
			<button click.delegate="ClickCancel()" class="bad" >CANCEL</button>
		</p>
	</div>
		
	<!-- CHOOSE ATTACK TARGET MODE -->
	<div class="" if.bind="mode=='attack' && !fleet.mission">
		<h2>Choose Target:</h2>
		<div repeat.for="f of fleet.star.fleets" 
			if.bind="!f.owner.is_player && f.ships.length && !f.killme"
			click.delegate="SelectAttackTarget(f)" >
			<p>
				<img src.bind="f.owner.flag_img" style="max-height: 3em; float: right;"/>
				<b>${f.owner.name} Fleet</b><br/>
				<span class="green">${f.ships.length}</span> ships
				<span class="green">${f.fp}</span> firepower
				<span class="green">${f.bulk}</span> mass
			</p>
			<div>
				<div repeat.for="[bp,count] of f.ListUniqueModels()" style="display:inline-block;">
					<img src.one-time="bp.img" style="height:2em; width:2em; object-fit: contain;"  />x${count}&nbsp;
				</div>
			</div>
		</div>
		<p>
			<button class="bad" click.delegate="ClickCancelChooseAttackTarget()">CANCEL</button>
		</p>
	</div>
		
	<!-- CHOOSE-PLANET MODE -->
	<div class="star star_${fleet.star.color}" if.bind="mode == 'colonize'">
		<h2>Colonize ${fleet.star.name}</h2>
		<p style="font-weight:bold; color: #FAA;" >Choose a planet to colonize:</p>
		<div repeat.for="p of fleet.star.planets" class="hilite_wrapper" if.bind="p.owner === false && p.Habitable(fleet.owner.race)" click.delegate="ChoosePlanetToColonize(p)">
			<div class="planet atm${p.atm} tmp${p.temp}" css.one-time="PlanetSizeCSS(p)">
				<p class="env_label"><span class="env_label">${p.envDisplayName}</span></p>
				<div class="env_box">
					<div class="target"></div>
				</div>	
				<h3 css="color: ${p.ui_color};">${p.name}</h3>
				<div class="phys">
					<div class="size">
						<span class="size">${p.size}<br/><span class="size">SIZE</span></span>							
						<span class="mine">${p.rich}x<br/><span class="mine">MINING</span></span>
						<span class="en">${p.energy}x<br/><span class="en">ENERGY</span></span>
						<span class="${p.Habitable(app.game.myciv.race) ? (p.Adaptation( app.game.myciv.race ) < 0 ? 'alert' : 'good') : 'bad'}">
							${(p.Adaptation( app.game.myciv.race ) >= 0 ? '+' : '')}${p.Adaptation( app.game.myciv.race )}<br/>
							<span class="">ENV</span>
						</span>					
					</div>			
				</div>
			</div>
		</div>
		<p class="button_rack">
			<button  click.delegate="ClickCancel()" class="bad">CANCEL</button>
		</p>		
	</div>
		
	<!-- TROOP TRANSFER MODE -->
	<div class="star star_${fleet.star.color}" if.bind="mode == 'troopswap'">
		<h2>Transfer Troops</h2>
		
		<p class="button_rack button_rack_fill">
			<button click.delegate="ClickCancel()" class="">DONE</button>
		</p>	
		
		<template containerless if.bind="fleet.star">
			
			<progress min="0" max.bind="fleet.troopcap" value.bind="fleet.troops" 
				style="width: 100%;" 
				class="short topless ${fleet.troops==fleet.troopcap ? 'full' : ''}">
			</progress>
			<p if.bind="!trooplist.length" class="centered">No Troops In Fleet</p>
			<div class="trooplist">
				<img src="img/ground/tank_transp.png" 
					style="
						height: 32px; 
						width: 32px; 
						display: inline-block; 
						border: 1px solid white; 
						border-radius: 0.25em; 
						overflow: hidden; 
						padding: 0.25em; 
						margin: 0 0.5em 0.5em 0;
						"
					repeat.for="t of trooplist"
					click.trigger="ClickTroop(t,fleet)"
				/>
			</div>
			
			<p class="button_rack button_rack_fill"> 
				<button class="" click.delegate="TransferTroopsFromPlanet()">‚ñ≤</button>
				<button class="" click.delegate="TransferTroopsToPlanet()">‚ñº</button>
			</p>
			
			<div repeat.for="p of fleet.star.planets" 
				class="hilite_wrapper ${p==selected_planet ? 'selected' : ''}" 
				if.bind="p.owner.is_player"
				click.delegate="ClickPlanetForTroops(p)"
				>
				<div class="planet atm${p.atm} tmp${p.temp}" css.one-time="PlanetSizeCSS(p)">
					<p css="color: ${p.ui_color}; font-weight:bold;">${p.name}</p>
					<div class="trooplist">
						<img src="img/ground/tank_transp.png" 
							style="
								height: 32px; 
								width: 32px; 
								display: inline-block; 
								border: 1px solid white; 
								border-radius: 0.25em; 
								overflow: hidden; 
								padding: 0.25em; 
								margin: 0 0.5em 0.5em 0;
								"
							repeat.for="t of p.troops"
							click.trigger="ClickTroop(t,p)"
						/>
					</div>
					
				</div>
			</div>
		</template>	
	</div>
	
	<!-- INVASION PLANET SELECTOR -->
	<div class="star star_${fleet.star.color}" if.bind="mode=='invade'">
		
		<p class="button_rack button_rack_fill">
			<button click.delegate="ClickCancel()" class="bad">CANCEL</button>
		</p>	
		
		<template containerless if.bind="fleet.star">
			<p>Our Forces:</p>
			<div repeat.for="[bp,count] of fleet.ListUniqueGroundUnits()" style="display:inline-block;">
				<img src="img/ground/tank_transp.png" 
					style="
						height: 32px; 
						width: 32px; 
						display: inline-block; 
						border: 1px solid white; 
						border-radius: 0.25em; 
						overflow: hidden; 
						padding: 0.25em; 
						"
				/>&nbsp;x${count}&nbsp;
			</div>
			
			<h2>Invade Which?</h2>
			<div repeat.for="p of fleet.star.planets" 
				class="hilite_wrapper ${p==selected_planet ? 'selected' : ''}" 
				if.bind="p.owner && !p.owner.is_player"
				click.delegate="ClickPlanetToInvade(p)"
				>
				<div class="planet atm${p.atm} tmp${p.temp}" css.one-time="PlanetSizeCSS(p)">
					<p>
						<span css="color: ${p.ui_color}; font-weight:bold;">${p.name}</span> 
						Odds: <b>${CalculateChanceOfGroundVictory(p) * 100 | round}%</b>
					</p>
					<div repeat.for="[bp,count] of p.ListUniqueGroundUnits()" style="display:inline-block;">
						<img src="img/ground/tank_transp.png" 
							style="
								height: 32px; 
								width: 32px; 
								display: inline-block; 
								border: 1px solid white; 
								border-radius: 0.25em; 
								overflow: hidden; 
								padding: 0.25em; 
								"
						/>&nbsp;x${count}&nbsp;
					</div>		
				</div>
			</div>
		</template>
		
	</div>
	
</template>
